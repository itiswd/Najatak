import 'package:flutter/material.dart';
import 'package:flutter_local_notifications/flutter_local_notifications.dart';
import 'package:flutter_localizations/flutter_localizations.dart';

import 'screens/home_screen.dart';
import 'services/notification_service.dart';

final FlutterLocalNotificationsPlugin flutterLocalNotificationsPlugin =
    FlutterLocalNotificationsPlugin();

void main() async {
  WidgetsFlutterBinding.ensureInitialized();

  await NotificationService.initialize();

  runApp(const Najatak());
}

class Najatak extends StatelessWidget {
  const Najatak({super.key});

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'نَجَاتَك',
      debugShowCheckedModeBanner: false,
      localizationsDelegates: const [
        GlobalMaterialLocalizations.delegate,
        GlobalWidgetsLocalizations.delegate,
        GlobalCupertinoLocalizations.delegate,
      ],
      supportedLocales: const [Locale('ar', ''), Locale('en', '')],
      locale: const Locale('ar', ''),
      theme: ThemeData(
        primarySwatch: Colors.teal,
        fontFamily: 'Cairo',
        colorScheme: ColorScheme.fromSeed(
          seedColor: const Color(0xFF1B5E20),
          brightness: Brightness.light,
        ),
        scaffoldBackgroundColor: const Color(0xFFF5F5F5),
        appBarTheme: const AppBarTheme(
          backgroundColor: Color(0xFF1B5E20),
          foregroundColor: Colors.white,
          elevation: 0,
          centerTitle: true,
        ),
        cardTheme: CardThemeData(
          elevation: 2,
          shape: RoundedRectangleBorder(
            borderRadius: BorderRadius.circular(15),
          ),
        ),
      ),
      home: const HomeScreen(),
    );
  }
}
class Azkar {
  final String count;
  final int countInt;
  final String zekr;
  final String? reference;
  final String? description;
  final String? audioPath;

  Azkar({
    required this.count,
    required this.countInt,
    required this.zekr,
    this.reference,
    this.description,
    this.audioPath,
  });

  factory Azkar.fromJson(Map<String, dynamic> json) {
    // نستخدم 'path' لـ audioPath كما في البيانات المُدخلة
    // ونستخدم 'int' لـ countInt
    return Azkar(
      count: json['count'] ?? 'مرة واحدة',
      countInt: json['int'] ?? 1,
      zekr: json['zekr'] ?? '',
      reference: json['reference'],
      description: json['description'],
      audioPath: json['path'],
    );
  }
}

class AzkarData {
  // --- أذكار الصباح (كما هي في المُدخل) ---
  static final List<Azkar> morningAzkar = [
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr:
          'اللّهُ لاَ إِلَـهَ إِلاَّ هُوَ الْحَيُّ الْقَيُّومُ لاَ تَأْخُذُهُ سِنَةٌ وَلاَ نَوْمٌ لَّهُ مَا فِي السَّمَاوَاتِ وَمَا فِي الأَرْضِ مَن ذَا الَّذِي يَشْفَعُ عِنْدَهُ إِلاَّ بِإِذْنِهِ يَعْلَمُ مَا بَيْنَ أَيْدِيهِمْ وَمَا خَلْفَهُمْ وَلاَ يُحِيطُونَ بِشَيْءٍ مِّنْ عِلْمِهِ إِلاَّ بِمَا شَاء وَسِعَ كُرْسِيُّهُ السَّمَاوَاتِ وَالأَرْضَ وَلاَ يَؤُودُهُ حِفْظُهُمَا وَهُوَ الْعَلِيُّ الْعَظِيمُ.',
      reference: '[آية الكرسى - البقرة 255].',
      description:
          'من قالها حين يصبح أجير من الجن حتى يمسى ومن قالها حين يمسى أجير من الجن حتى يصبح.',
    ),
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr:
          'آمَنَ الرَّسُولُ بِمَا أُنْزِلَ إِلَيْهِ مِنْ رَبِّهِ وَالْمُؤْمِنُونَ ۚ كُلٌّ آمَنَ بِاللَّهِ وَمَلَائِكَتِهِ وَكُتُبِهِ وَرُسُلِهِ لَا نُفَرِّقُ بَيْنَ أَحَدٍ مِنْ رُسُلِهِ ۚ وَقَالُوا سَمِعْنَا وَأَطَعْنَا ۖ غُفْرَانَكَ رَبَّنَا وَإِلَيْكَ الْمَصِيرُ. لَا يُكَلِّفُ اللَّهُ نَفْسًا إِلَّا وُسْعَهَا لَهَا مَا كَسَبَتْ وَعَلَيْهَا مَا اكْتَسَبَتْ رَبَّنَا لَا تُؤَاخِذْنَا إِنْ نَّسِينَآ أَوْ أَخْطَأْنَا رَبَّنَا وَلَا تَحْمِلْ عَلَيْنَا إِصْرًا كَمَا حَمَلْتَهُ عَلَى الَّذِينَ مِنْ قَبْلِنَا رَبَّنَا وَلَا تُحَمِّلْنَا مَا لَا طَاقَةَ لَنَا بِهِ وَاعْفُ عَنَّا وَاغْفِرْ لَنَا وَارْحَمْنَا أَنْتَ مَوْلَانَا فَانْصُرْنَا عَلَى الْقَوْمِ الْكَافِرِينَ.',
      reference: '[البقرة 285 - 286].',
      description: 'من قرأ آيتين من آخر سورة البقرة في ليلة كفتاه.',
    ),
    Azkar(
      count: 'ثلاث مرات',
      countInt: 3,
      zekr:
          'قُلْ هُوَ ٱللَّهُ أَحَدٌ، ٱللَّهُ ٱلصَّمَدُ، لَمْ يَلِدْ وَلَمْ يُولَدْ، وَلَمْ يَكُن لَّهُۥ كُفُوًا أَحَدٌۢ.',
      reference: 'سورة الإخلاص',
      description:
          'من قالها حين يصبح وحين يمسى كفته من كل شىء (الإخلاص والمعوذتين).',
    ),
    Azkar(
      count: 'ثلاث مرات',
      countInt: 3,
      zekr:
          'قُلْ أَعُوذُ بِرَبِّ ٱلْفَلَقِ، مِن شَرِّ مَا خَلَقَ، وَمِن شَرِّ غَاسِقٍ إِذَا وَقَبَ، وَمِن شَرِّ ٱلنَّفَّٰثَٰتِ فِى ٱلْعُقَدِ، وَمِن شَرِّ حَاسِدٍ إِذَا حَسَدَ.',
      reference: 'سورة الفلق',
      description:
          'من قالها حين يصبح وحين يمسى كفته من كل شىء (الإخلاص والمعوذتين).',
    ),
    Azkar(
      count: 'ثلاث مرات',
      countInt: 3,
      zekr:
          'قُلْ أَعُوذُ بِرَبِّ ٱلنَّاسِ، مَلِكِ ٱلنَّاسِ، إِلَٰهِ ٱلنَّاسِ، مِن شَرِّ ٱلْوَسْوَاسِ ٱلْخَنَّاسِ، ٱلَّذِى يُوَسْوِسُ فِى صُدُورِ ٱلنَّاسِ، مِنَ ٱلْجِنَّةِ وَٱلنَّاسِ.',
      reference: 'سورة الناس',
      description:
          'من قالها حين يصبح وحين يمسى كفته من كل شىء (الإخلاص والمعوذتين).',
    ),
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr:
          'أَمْسَيْـنا وَأَمْسـى المـلكُ لله وَالحَمدُ لله ، لا إلهَ إلاّ اللّهُ وَحدَهُ لا شَريكَ لهُ، لهُ المُـلكُ ولهُ الحَمْـد، وهُوَ على كلّ شَيءٍ قدير ، رَبِّ أسْـأَلُـكَ خَـيرَ ما في هـذهِ اللَّـيْلَةِ وَخَـيرَ ما بَعْـدَهـا ، وَأَعـوذُ بِكَ مِنْ شَـرِّ ما في هـذهِ اللَّـيْلةِ وَشَرِّ ما بَعْـدَهـا ، رَبِّ أَعـوذُبِكَ مِنَ الْكَسَـلِ وَسـوءِ الْكِـبَر ، رَبِّ أَعـوذُ بِكَ مِنْ عَـذابٍ في النّـارِ وَعَـذابٍ في القَـبْر.',
      reference: 'صحيح مسلم',
    ),
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr:
          'اللّهـمَّ أَنْتَ رَبِّـي لا إلهَ إلاّ أَنْتَ ، خَلَقْتَنـي وَأَنا عَبْـدُك ، وَأَنا عَلـى عَهْـدِكَ وَوَعْـدِكَ ما اسْتَـطَعْـت ، أَعـوذُبِكَ مِنْ شَـرِّ ما صَنَـعْت ، أَبـوءُ لَـكَ بِنِعْـمَتِـكَ عَلَـيَّ وَأَبـوءُ بِذَنْـبي فَاغْفـِرْ لي فَإِنَّـهُ لا يَغْـفِرُ الذُّنـوبَ إِلاّ أَنْتَ .',
      reference: 'صحيح البخاري',
      description:
          'من قالها موقنا بها حين يمسى ومات من ليلته دخل الجنة وكذلك حين يصبح.',
    ),
    Azkar(
      count: 'ثلاث مرات',
      countInt: 3,
      zekr:
          'رَضيـتُ بِاللهِ رَبَّـاً وَبِالإسْلامِ ديـناً وَبِمُحَـمَّدٍ صلى الله عليه وسلم نَبِيّـاً.',
      reference: 'الإمام أحمد',
      description:
          'من قالها حين يصبح وحين يمسى كان حقا على الله أن يرضيه يوم القيامة.',
    ),
    Azkar(
      count: 'اربع مرات',
      countInt: 4,
      zekr:
          'اللّهُـمَّ إِنِّـي أَمسيتُ أُشْـهِدُك ، وَأُشْـهِدُ حَمَلَـةَ عَـرْشِـك ، وَمَلَائِكَتَكَ ، وَجَمـيعَ خَلْـقِك ، أَنَّـكَ أَنْـتَ اللهُ لا إلهَ إلاّ أَنْـتَ وَحْـدَكَ لا شَريكَ لَـك ، وَأَنَّ ُ مُحَمّـداً عَبْـدُكَ وَرَسـولُـك.',
      reference: 'سنن أبي داود',
      description: 'من قالها أعتقه الله من النار.',
    ),
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr:
          'اللّهُـمَّ ما أَمسى بي مِـنْ نِعْـمَةٍ أَو بِأَحَـدٍ مِـنْ خَلْـقِك ، فَمِـنْكَ وَحْـدَكَ لا شريكَ لَـك ، فَلَـكَ الْحَمْـدُ وَلَـكَ الشُّكْـر.',
      reference: 'سنن أبي داود',
      description: 'من قالها حين يمسى أدى شكر يومه.',
    ),
    Azkar(
      count: 'سبع مرات',
      countInt: 7,
      zekr:
          'حَسْبِـيَ اللّهُ لا إلهَ إلاّ هُوَ عَلَـيهِ تَوَكَّـلتُ وَهُوَ رَبُّ العَرْشِ العَظـيم.',
      reference: 'ابن السني',
      description: 'من قالها كفاه الله ما أهمه من أمر الدنيا والأخرة.',
    ),
    Azkar(
      count: 'ثلاث مرات',
      countInt: 3,
      zekr:
          'بِسـمِ اللهِ الذي لا يَضُـرُّ مَعَ اسمِـهِ شَيءٌ في الأرْضِ وَلا في السّمـاءِ وَهـوَ السّمـيعُ العَلـيم.',
      reference: 'سنن ابن ماجه',
      description: 'لم يضره من الله شيء.',
    ),
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr:
          'اللّهُـمَّ بِكَ أَمْسَـينا وَبِكَ أَصْـبَحْنا، وَبِكَ نَحْـيا وَبِكَ نَمُـوتُ وَإِلَـيْكَ الْمَصِيرُ.',
      reference: 'سنن الترمذي',
    ),
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr:
          'أَمْسَيْنَا عَلَى فِطْرَةِ الإسْلاَمِ، وَعَلَى كَلِمَةِ الإِخْلاَصِ، وَعَلَى دِينِ نَبِيِّنَا مُحَمَّدٍ صَلَّى اللهُ عَلَيْهِ وَسَلَّمَ، وَعَلَى مِلَّةِ أَبِينَا إبْرَاهِيمَ حَنِيفاً مُسْلِماً وَمَا كَانَ مِنَ المُشْرِكِينَ.',
      reference: 'الإمام أحمد',
    ),
    Azkar(
      count: 'ثلاث مرات',
      countInt: 3,
      zekr:
          'سُبْحـانَ اللهِ وَبِحَمْـدِهِ عَدَدَ خَلْـقِه ، وَرِضـا نَفْسِـه ، وَزِنَـةَ عَـرْشِـه ، وَمِـدادَ كَلِمـاتِـه.',
      reference: 'صحيح مسلم',
    ),
    Azkar(
      count: 'ثلاث مرات',
      countInt: 3,
      zekr:
          'اللّهُـمَّ عافِـني في بَدَنـي ، اللّهُـمَّ عافِـني في سَمْـعي ، اللّهُـمَّ عافِـني في بَصَـري ، لا إلهَ إلاّ أَنْـتَ ، اللّهُـمَّ إِنّـي أَعـوذُ بِكَ مِنَ الْكُـفر ، وَالفَـقْر ، وَأَعـوذُ بِكَ مِنْ عَذابِ القَـبْر ، لا إلهَ إلاّ أَنْـتَ.',
    ),
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr:
          'اللّهُـمَّ إِنِّـي أسْـأَلُـكَ العَـفْوَ وَالعـافِـيةَ في الدُّنْـيا وَالآخِـرَة ، اللّهُـمَّ إِنِّـي أسْـأَلُـكَ العَـفْوَ وَالعـافِـيةَ في ديني وَدُنْـيايَ وَأهْـلي وَمالـي ، اللّهُـمَّ اسْتُـرْ عـوْراتي وَآمِـنْ رَوْعاتـي ، اللّهُـمَّ احْفَظْـني مِن بَـينِ يَدَيَّ وَمِن خَلْفـي وَعَن يَمـيني وَعَن شِمـالي ، وَمِن فَوْقـي ، وَأَعـوذُ بِعَظَمَـتِكَ أَن أُغْـتالَ مِن تَحْتـي.',
      reference: 'سنن ابن ماجه',
    ),
    Azkar(
      count: 'ثلاث مرات',
      countInt: 3,
      zekr:
          'يَا حَيُّ يَا قيُّومُ بِرَحْمَتِكَ أسْتَغِيثُ أصْلِحْ لِي شَأنِي كُلَّهُ وَلاَ تَكِلْنِي إلَى نَفْسِي طَـرْفَةَ عَيْنٍ.',
      reference: '(المستدرك على الصحيحين)الحاكم',
    ),
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr:
          'أَمْسَيْنا وَأَمْسَى الْمُلْكُ للهِ رَبِّ الْعَالَمَيْنِ، اللَّهُمَّ إِنَّي أسْأَلُكَ خَيْرَ هَذَه اللَّيْلَةِ فَتْحَهَا ونَصْرَهَا، ونُوْرَهَا وبَرَكَتهَا، وَهُدَاهَا، وَأَعُوذُ بِكَ مِنْ شَرِّ مَا فيهِا وَشَرَّ مَا بَعْدَهَا.',
      reference: 'سنن أبي داود',
    ),
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr:
          'اللّهُـمَّ عالِـمَ الغَـيْبِ وَالشّـهادَةِ فاطِـرَ السّماواتِ وَالأرْضِ رَبَّ كـلِّ شَـيءٍ وَمَليـكَه ، أَشْهَـدُ أَنْ لا إِلـهَ إِلاّ أَنْت ، أَعـوذُ بِكَ مِن شَـرِّ نَفْسـي وَمِن شَـرِّ الشَّيْـطانِ وَشِرْكِهِ ، وَأَنْ أَقْتَـرِفَ عَلـى نَفْسـي سوءاً أَوْ أَجُـرَّهُ إِلـى مُسْـلِم.',
      reference: 'سنن الترمذي',
    ),
    Azkar(
      count: 'ثلاث مرات',
      countInt: 3,
      zekr: 'أَعـوذُ بِكَلِمـاتِ اللّهِ التّـامّـاتِ مِنْ شَـرِّ ما خَلَـق.',
    ),
    Azkar(
      count: 'عشر مرات',
      countInt: 10,
      zekr: 'اللَّهُمَّ صَلِّ وَسَلِّمْ وَبَارِكْ على نَبِيِّنَا مُحمَّد.',
      reference: 'الطبراني',
      description: 'من صلى على حين يصبح وحين يمسى ادركته شفاعتى يوم القيامة.',
    ),
    Azkar(
      count: 'ثلاث مرات',
      countInt: 3,
      zekr:
          'اللَّهُمَّ إِنَّا نَعُوذُ بِكَ مِنْ أَنْ نُشْرِكَ بِكَ شَيْئًا نَعْلَمُهُ ، وَنَسْتَغْفِرُكَ لِمَا لَا نَعْلَمُهُ.',
    ),
    Azkar(
      count: 'ثلاث مرات',
      countInt: 3,
      zekr:
          'اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنْ الْهَمِّ وَالْحَزَنِ، وَأَعُوذُ بِكَ مِنْ الْعَجْزِ وَالْكَسَلِ، وَأَعُوذُ بِكَ مِنْ الْجُبْنِ وَالْبُخْلِ، وَأَعُوذُ بِكَ مِنْ غَلَبَةِ الدَّيْنِ، وَقَهْرِ الرِّجَالِ.',
      reference: 'سنن أبي داود',
    ),
    Azkar(
      count: 'ثلاث مرات',
      countInt: 3,
      zekr:
          'أسْتَغْفِرُ اللهَ العَظِيمَ الَّذِي لاَ إلَهَ إلاَّ هُوَ، الحَيُّ القَيُّومُ، وَأتُوبُ إلَيهِ.',
    ),
    Azkar(
      count: 'ثلاث مرات',
      countInt: 3,
      zekr:
          'يَا رَبِّ , لَكَ الْحَمْدُ كَمَا يَنْبَغِي لِجَلَالِ وَجْهِكَ , وَلِعَظِيمِ سُلْطَانِكَ.',
    ),
    Azkar(
      count: 'مائة مرة',
      countInt: 100,
      zekr:
          'لَا إلَه إلّا اللهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ وَهُوَ عَلَى كُلِّ شَيْءِ قَدِيرِ.',
      reference: 'البخاري و مسلم',
      description:
          'كانت له عدل عشر رقاب، وكتبت له مئة حسنة، ومحيت عنه مئة سيئة، وكانت له حرزا من الشيطان.',
    ),
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr:
          'اللَّهُمَّ أَنْتَ رَبِّي لا إِلَهَ إِلا أَنْتَ ، عَلَيْكَ تَوَكَّلْتُ ، وَأَنْتَ رَبُّ الْعَرْشِ الْعَظِيمِ , مَا شَاءَ اللَّهُ كَانَ ، وَمَا لَمْ يَشَأْ لَمْ يَكُنْ ، وَلا حَوْلَ وَلا قُوَّةَ إِلا بِاللَّهِ الْعَلِيِّ الْعَظِيمِ , أَعْلَمُ أَنَّ اللَّهَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ ، وَأَنَّ اللَّهَ قَدْ أَحَاطَ بِكُلِّ شَيْءٍ عِلْمًا , اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنْ شَرِّ نَفْسِي ، وَمِنْ شَرِّ كُلِّ دَابَّةٍ أَنْتَ آخِذٌ بِنَاصِيَتِهَا ، إِنَّ رَبِّي عَلَى صِرَاطٍ مُسْتَقِيمٍ.',
      description: 'ذكر طيب.',
    ),
    Azkar(
      count: 'مائة مرة',
      countInt: 100,
      zekr: 'سُبْحـانَ اللهِ وَبِحَمْـدِهِ.',
      reference: 'صحيح مسلم',
      description:
          'حُطَّتْ خَطَايَاهُ وَإِنْ كَانَتْ مِثْلَ زَبَدِ الْبَحْرِ. لَمْ يَأْتِ أَحَدٌ يَوْمَ الْقِيَامَةِ بِأَفْضَلَ مِمَّا جَاءَ بِهِ إِلَّا أَحَدٌ قَالَ مِثْلَ مَا قَالَ أَوْ زَادَ عَلَيْهِ.',
    ),
  ];

  // --- أذكار النوم (كما هي في المُدخل) ---
  static final List<Azkar> sleepAzkar = [
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr:
          'بِاسْمِكَ رَبَِّؤُودُهُ حِفْظُهُمَا وَهُوَ الْعَلِيُّ الْعَظِيمُ.', // *تنبيه: هذا الذكر يبدو أنه نسخة مكررة ومحرفة من آية الكرسي. يُرجى مراجعته.
      reference: '[آية الكرسى - البقرة 255].',
      description:
          'من قالها حين يصبح أجير من الجن حتى يمسى ومن قالها حين يمسى أجير من الجن حتى يصبح.',
    ),
    Azkar(
      count: 'ثلاث مرات',
      countInt: 3,
      zekr:
          'قُلْ هُوَ ٱللَّهُ أَحَدٌ، ٱللَّهُ ٱلصَّمَدُ، لَمْ يَلِدْ وَلَمْ يُولَدْ، وَلَمْ يَكُن لَّهُۥ كُفُوًا أَحَدٌۢ.',
      reference: 'سورة الإخلاص',
      description:
          'من قالها حين يصبح وحين يمسى كفته من كل شىء (الإخلاص والمعوذتين).',
    ),
    Azkar(
      count: 'ثلاث مرات',
      countInt: 3,
      zekr:
          'قُلْ أَعُوذُ بِرَبِّ ٱلْفَلَقِ، مِن شَرِّ مَا خَلَقَ، وَمِن شَرِّ غَاسِقٍ إِذَا وَقَبَ، وَمِن شَرِّ ٱلنَّفَّٰثَٰتِ فِى ٱلْعُقَدِ، وَمِن شَرِّ حَاسِدٍ إِذَا حَسَدَ.',
      reference: 'سورة الفلق',
      description:
          'من قالها حين يصبح وحين يمسى كفته من كل شىء (الإخلاص والمعوذتين).',
    ),
    Azkar(
      count: 'ثلاث مرات',
      countInt: 3,
      zekr:
          'قُلْ أَعُوذُ بِرَبِّ ٱلنَّاسِ، مَلِكِ ٱلنَّاسِ، إِلَٰهِ ٱلنَّاسِ، مِن شَرِّ ٱلْوَسْوَاسِ ٱلْخَنَّاسِ، ٱلَّذِى يُوَسْوِسُ فِى صُدُورِ ٱلنَّاسِ، مِنَ ٱلْجِنَّةِ وَٱلنَّاسِ.',
      reference: 'سورة الناس',
      description:
          'من قالها حين يصبح وحين يمسى كفته من كل شىء (الإخلاص والمعوذتين).',
    ),
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr:
          'أَصْـبَحْنا وَأَصْـبَحَ المُـلْكُ لله وَالحَمدُ لله ، لا إلهَ إلاّ اللّهُ وَحدَهُ لا شَريكَ لهُ، لهُ المُـلكُ ولهُ الحَمْـد، وهُوَ على كلّ شَيءٍ قدير ، رَبِّ أسْـأَلُـكَ خَـيرَ ما في هـذا اليوم وَخَـيرَ ما بَعْـدَه ، وَأَعـوذُ بِكَ مِنْ شَـرِّ ما في هـذا اليوم وَشَرِّ ما بَعْـدَه، رَبِّ أَعـوذُبِكَ مِنَ الْكَسَـلِ وَسـوءِ الْكِـبَر ، رَبِّ أَعـوذُ بِكَ مِنْ عَـذابٍ في النّـارِ وَعَـذابٍ في القَـبْر.',
      reference: 'صحيح مسلم',
    ),
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr:
          'اللّهـمَّ أَنْتَ رَبِّـي لا إلهَ إلاّ أَنْتَ ، خَلَقْتَنـي وَأَنا عَبْـدُك ، وَأَنا عَلـى عَهْـدِكَ وَوَعْـدِكَ ما اسْتَـطَعْـت ، أَعـوذُبِكَ مِنْ شَـرِّ ما صَنَـعْت ، أَبـوءُ لَـكَ بِنِعْـمَتِـكَ عَلَـيَّ وَأَبـوءُ بِذَنْـبي فَاغْفـِرْ لي فَإِنَّـهُ لا يَغْـفِرُ الذُّنـوبَ إِلاّ أَنْتَ .',
      reference: 'صحيح البخاري',
      description:
          'من قالها موقنا بها حين يمسى ومات من ليلته دخل الجنة وكذلك حين يصبح.',
    ),
    Azkar(
      count: 'ثلاث مرات',
      countInt: 3,
      zekr:
          'رَضيـتُ بِاللهِ رَبَّـاً وَبِالإسْلامِ ديـناً وَبِمُحَـمَّدٍ صلى الله عليه وسلم نَبِيّـاً.',
      reference: 'الإمام أحمد',
      description:
          'من قالها حين يصبح وحين يمسى كان حقا على الله أن يرضيه يوم القيامة.',
    ),
    Azkar(
      count: 'اربع مرات',
      countInt: 4,
      zekr:
          'اللّهُـمَّ إِنِّـي أَصْبَـحْتُ أُشْـهِدُك ، وَأُشْـهِدُ حَمَلَـةَ عَـرْشِـك ، وَمَلَائِكَتَكَ ، وَجَمـيعَ خَلْـقِك ، أَنَّـكَ أَنْـتَ اللهُ لا إلهَ إلاّ أَنْـتَ وَحْـدَكَ لا شَريكَ لَـك ، وَأَنَّ ُ مُحَمّـداً عَبْـدُكَ وَرَسـولُـك.',
      reference: 'سنن أبي داود',
      description: 'من قالها أعتقه الله من النار.',
    ),
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr:
          'اللّهُـمَّ ما أَصْبَـَحَ بي مِـنْ نِعْـمَةٍ أَو بِأَحَـدٍ مِـنْ خَلْـقِك ، فَمِـنْكَ وَحْـدَكَ لا شريكَ لَـك ، فَلَـكَ الْحَمْـدُ وَلَـكَ الشُّكْـر.',
      reference: 'سنن أبي داود',
      description: 'من قالها حين يصبح أدى شكر يومه.',
    ),
    Azkar(
      count: 'سبع مرات',
      countInt: 7,
      zekr:
          'حَسْبِـيَ اللّهُ لا إلهَ إلاّ هُوَ عَلَـيهِ تَوَكَّـلتُ وَهُوَ رَبُّ العَرْشِ العَظـيم.',
      reference: 'ابن السني',
      description: 'من قالها كفاه الله ما أهمه من أمر الدنيا والأخرة.',
    ),
    Azkar(
      count: 'ثلاث مرات',
      countInt: 3,
      zekr:
          'بِسـمِ اللهِ الذي لا يَضُـرُّ مَعَ اسمِـهِ شَيءٌ في الأرْضِ وَلا في السّمـاءِ وَهـوَ السّمـيعُ العَلـيم.',
      reference: 'سنن ابن ماجه',
      description: 'لم يضره من الله شيء.',
    ),
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr:
          'اللّهُـمَّ بِكَ أَصْـبَحْنا وَبِكَ أَمْسَـينا ، وَبِكَ نَحْـيا وَبِكَ نَمُـوتُ وَإِلَـيْكَ النُّـشُور.',
      reference: 'سنن الترمذي',
    ),
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr:
          'أَصْبَـحْـنا عَلَى فِطْرَةِ الإسْلاَمِ، وَعَلَى كَلِمَةِ الإِخْلاَصِ، وَعَلَى دِينِ نَبِيِّنَا مُحَمَّدٍ صَلَّى اللهُ عَلَيْهِ وَسَلَّمَ، وَعَلَى مِلَّةِ أَبِينَا إبْرَاهِيمَ حَنِيفاً مُسْلِماً وَمَا كَانَ مِنَ المُشْرِكِينَ.',
      reference: 'الإمام أحمد',
    ),
    Azkar(
      count: 'ثلاث مرات',
      countInt: 3,
      zekr:
          'سُبْحـانَ اللهِ وَبِحَمْـدِهِ عَدَدَ خَلْـقِه ، وَرِضـا نَفْسِـه ، وَزِنَـةَ عَـرْشِـه ، وَمِـدادَ كَلِمـاتِـه.',
      reference: 'صحيح مسلم',
    ),
    Azkar(
      count: 'ثلاث مرات',
      countInt: 3,
      zekr:
          'اللّهُـمَّ عافِـني في بَدَنـي ، اللّهُـمَّ عافِـني في سَمْـعي ، اللّهُـمَّ عافِـني في بَصَـري ، لا إلهَ إلاّ أَنْـتَ ، اللّهُـمَّ إِنّـي أَعـوذُ بِكَ مِنَ الْكُـفر ، وَالفَـقْر ، وَأَعـوذُ بِكَ مِنْ عَذابِ القَـبْر ، لا إلهَ إلاّ أَنْـتَ.',
      reference: 'الإمام أحمد',
    ),
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr:
          'اللّهُـمَّ إِنِّـي أسْـأَلُـكَ العَـفْوَ وَالعـافِـيةَ في الدُّنْـيا وَالآخِـرَة ، اللّهُـمَّ إِنِّـي أسْـأَلُـكَ العَـفْوَ وَالعـافِـيةَ في ديني وَدُنْـيايَ وَأهْـلي وَمالـي ، اللّهُـمَّ اسْتُـرْ عـوْراتي وَآمِـنْ رَوْعاتـي ، اللّهُـمَّ احْفَظْـني مِن بَـينِ يَدَيَّ وَمِن خَلْفـي وَعَن يَمـيني وَعَن شِمـالي ، وَمِن فَوْقـي ، وَأَعـوذُ بِعَظَمَـتِكَ أَن أُغْـتالَ مِن تَحْتـي.',
      reference: 'سنن ابن ماجه',
    ),
    Azkar(
      count: 'ثلاث مرات',
      countInt: 3,
      zekr:
          'يَا حَيُّ يَا قيُّومُ بِرَحْمَتِكَ أسْتَغِيثُ أصْلِحْ لِي شَأنِي كُلَّهُ وَلاَ تَكِلْنِي إلَى نَفْسِي طَـرْفَةَ عَيْنٍ.',
      reference: '(المستدرك على الصحيحين)الحاكم',
    ),
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr:
          'أَصْبَـحْـنا وَأَصْبَـحْ المُـلكُ للهِ رَبِّ العـالَمـين ، اللّهُـمَّ إِنِّـي أسْـأَلُـكَ خَـيْرَ هـذا الـيَوْم ، فَـتْحَهُ ، وَنَصْـرَهُ ، وَنـورَهُ وَبَـرَكَتَـهُ ، وَهُـداهُ ، وَأَعـوذُ بِـكَ مِـنْ شَـرِّ ما فـيهِ وَشَـرِّ ما بَعْـدَه.',
      reference: 'سنن أبي داود',
    ),
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr:
          'اللّهُـمَّ عالِـمَ الغَـيْبِ وَالشّـهادَةِ فاطِـرَ السّماواتِ وَالأرْضِ رَبَّ كـلِّ شَـيءٍ وَمَليـكَه ، أَشْهَـدُ أَنْ لا إِلـهَ إِلاّ أَنْت ، أَعـوذُ بِكَ مِن شَـرِّ نَفْسـي وَمِن شَـرِّ الشَّيْـطانِ وَشِرْكِهِ ، وَأَنْ أَقْتَـرِفَ عَلـى نَفْسـي سوءاً أَوْ أَجُـرَّهُ إِلـى مُسْـلِم.',
      reference: 'سنن الترمذي',
    ),
    Azkar(
      count: 'ثلاث مرات',
      countInt: 3,
      zekr: 'أَعـوذُ بِكَلِمـاتِ اللّهِ التّـامّـاتِ مِنْ شَـرِّ ما خَلَـق.',
    ),
    Azkar(
      count: 'عشر مرات',
      countInt: 10,
      zekr: 'اللَّهُمَّ صَلِّ وَسَلِّمْ وَبَارِكْ على نَبِيِّنَا مُحمَّد.',
      reference: 'الطبراني',
      description: 'من صلى على حين يصبح وحين يمسى ادركته شفاعتى يوم القيامة.',
    ),
    Azkar(
      count: 'ثلاث مرات',
      countInt: 3,
      zekr:
          'اللَّهُمَّ إِنَّا نَعُوذُ بِكَ مِنْ أَنْ نُشْرِكَ بِكَ شَيْئًا نَعْلَمُهُ ، وَنَسْتَغْفِرُكَ لِمَا لَا نَعْلَمُهُ.',
    ),
    Azkar(
      count: 'ثلاث مرات',
      countInt: 3,
      zekr:
          'اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنْ الْهَمِّ وَالْحَزَنِ، وَأَعُوذُ بِكَ مِنْ الْعَجْزِ وَالْكَسَلِ، وَأَعُوذُ بِكَ مِنْ الْجُبْنِ وَالْبُخْلِ، وَأَعُوذُ بِكَ مِنْ غَلَبَةِ الدَّيْنِ، وَقَهْرِ الرِّجَالِ.',
      reference: 'سنن أبي داود',
    ),
    Azkar(
      count: 'ثلاث مرات',
      countInt: 3,
      zekr:
          'أسْتَغْفِرُ اللهَ العَظِيمَ الَّذِي لاَ إلَهَ إلاَّ هُوَ، الحَيُّ القَيُّومُ، وَأتُوبُ إلَيهِ.',
    ),
    Azkar(
      count: 'ثلاث مرات',
      countInt: 3,
      zekr:
          'يَا رَبِّ , لَكَ الْحَمْدُ كَمَا يَنْبَغِي لِجَلَالِ وَجْهِكَ , وَلِعَظِيمِ سُلْطَانِكَ.',
    ),
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr:
          'اللَّهُمَّ إِنِّي أَسْأَلُكَ عِلْمًا نَافِعًا، وَرِزْقًا طَيِّبًا، وَعَمَلًا مُتَقَبَّلًا.',
      reference: 'سنن ابن ماجه',
    ),
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr:
          'اللَّهُمَّ أَنْتَ رَبِّي لا إِلَهَ إِلا أَنْتَ ، عَلَيْكَ تَوَكَّلْتُ ، وَأَنْتَ رَبُّ الْعَرْشِ الْعَظِيمِ , مَا شَاءَ اللَّهُ كَانَ ، وَمَا لَمْ يَشَأْ لَمْ يَكُنْ ، وَلا حَوْلَ وَلا قُوَّةَ إِلا بِاللَّهِ الْعَلِيِّ الْعَظِيمِ , أَعْلَمُ أَنَّ اللَّهَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ ، وَأَنَّ اللَّهَ قَدْ أَحَاطَ بِكُلِّ شَيْءٍ عِلْمًا , اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنْ شَرِّ نَفْسِي ، وَمِنْ شَرِّ كُلِّ دَابَّةٍ أَنْتَ آخِذٌ بِنَاصِيَتِهَا ، إِنَّ رَبِّي عَلَى صِرَاطٍ مُسْتَقِيمٍ.',
      description: 'ذكر طيب.',
    ),
    Azkar(
      count: 'مائة مرة',
      countInt: 100,
      zekr:
          'لَا إلَه إلّا اللهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ وَهُوَ عَلَى كُلِّ شَيْءِ قَدِيرِ.',
      reference: 'البخاري و مسلم',
      description:
          'من قالها 100 مرة في يوم كانت له عدل عشر رقاب، وكتبت له مئة حسنة، ومحيت عنه مئة سيئة، وكانت له حرزا من الشيطان في يومه ذلك حتى يمسي ولم يأتي أحد بأفضل مما جاء به إلا احد عمل أكثر من ذلك',
    ),
    Azkar(
      count: 'مائة مرة',
      countInt: 100,
      zekr: 'سُبْحـانَ اللهِ وَبِحَمْـدِهِ.',
      reference: 'صحيح مسلم',
      description:
          'حُطَّتْ خَطَايَاهُ وَإِنْ كَانَتْ مِثْلَ زَبَدِ الْبَحْرِ. لَمْ يَأْتِ أَحَدٌ يَوْمَ الْقِيَامَةِ بِأَفْضَلَ مِمَّا جَاءَ بِهِ إِلَّا أَحَدٌ قَالَ مِثْلَ مَا قَالَ أَوْ زَادَ عَلَيْهِ.',
    ),
    Azkar(
      count: 'مائة مرة',
      countInt: 100,
      zekr: 'أسْتَغْفِرُ اللهَ وَأتُوبُ إلَيْهِ',
      reference: 'صحيح البخاري',
      description:
          'مائة حسنة، ومُحيت عنه مائة سيئة، وكانت له حرزاً من الشيطان حتى يمسى.',
    ),
  ];

  // 🌙 أذكار المساء (تكملة من الداتا المُدخلة)
  static final List<Azkar> eveningAzkar = [
    // --- أول ذكر من القائمة المُدخلة (آية الكرسي)
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr:
          'اللّهُ لاَ إِلَـهَ إِلاَّ هُوَ الْحَيُّ الْقَيُّومُ لاَ تَأْخُذُهُ سِنَةٌ وَلاَ نَوْمٌ لَّهُ مَا فِي السَّمَاوَاتِ وَمَا فِي الأَرْضِ مَن ذَا الَّذِي يَشْفَعُ عِنْدَهُ إِلاَّ بِإِذْنِهِ يَعْلَمُ مَا بَيْنَ أَيْدِيهِمْ وَمَا خَلْفَهُمْ وَلاَ يُحِيطُونَ بِشَيْءٍ مِّنْ عِلْمِهِ إِلاَّ بِمَا شَاء وَسِعَ كُرْسِيُّهُ السَّمَاوَاتِ وَالأَرْضَ وَلاَ يَؤُودُهُ حِفْظُهُمَا وَهُوَ الْعَلِيُّ الْعَظِيمُ.',
      reference: '[آية الكرسى - البقرة 255].',
      description:
          'من قالها حين يصبح أجير من الجن حتى يمسى ومن قالها حين يمسى أجير من الجن حتى يصبح.',
      audioPath: "assets/azkaraudio/zekr (1).mp3",
    ),
    // --- تكملة الأذكار من الداتا المُدخلة (سورة البقرة، الإخلاص، الفلق، الناس)
    Azkar(
      count: ' مرة واحدة ',
      countInt: 1,
      zekr:
          'آمَنَ الرَّسُولُ بِمَا أُنْزِلَ إِلَيْهِ مِنْ رَبِّهِ وَالْمُؤْمِنُونَ ۚ كُلٌّ آمَنَ بِاللَّهِ وَمَلَائِكَتِهِ وَكُتُبِهِ وَرُسُلِهِ لَا نُفَرِّقُ بَيْنَ أَحَدٍ مِنْ رُسُلِهِ ۚ وَقَالُوا سَمِعْنَا وَأَطَعْنَا ۖ غُفْرَانَكَ رَبَّنَا وَإِلَيْكَ الْمَصِيرُ. لَا يُكَلِّفُ اللَّهُ نَفْسًا إِلَّا وُسْعَهَا لَهَا مَا كَسَبَتْ وَعَلَيْهَا مَا اكْتَسَبَتْ رَبَّنَا لَا تُؤَاخِذْنَا إِنْ نَّسِينَآ أَوْ أَخْطَأْنَا رَبَّنَا وَلَا تَحْمِلْ عَلَيْنَا إِصْرًا كَمَا حَمَلْتَهُ عَلَى الَّذِينَ مِنْ قَبْلِنَا رَبَّنَا وَلَا تُحَمِّلْنَا مَا لَا طَاقَةَ لَنَا بِهِ وَاعْفُ عَنَّا وَاغْفِرْ لَنَا وَارْحَمْنَا أَنْتَ مَوْلَانَا فَانْصُرْنَا عَلَى الْقَوْمِ الْكَافِرِينَ.',
      description: "من قرأ آيتين من آخر سورة البقرة في ليلة كفتاه.",
      reference: "[البقرة 285 - 286].",
      audioPath: "assets/azkaraudio/zekr (24).mp3",
    ),
    Azkar(
      count: ' ثلاث مرات ',
      countInt: 3,
      zekr:
          'قُلْ هُوَ ٱللَّهُ أَحَدٌ، ٱللَّهُ ٱلصَّمَدُ، لَمْ يَلِدْ وَلَمْ يُولَدْ، وَلَمْ يَكُن لَّهُۥ كُفُوًا أَحَدٌۢ.',
      description:
          "من قالها حين يصبح وحين يمسى كفته من كل شىء (الإخلاص والمعوذتين).",
      reference: "سورة الإخلاص",
      audioPath: "assets/azkaraudio/zekr (2).mp3",
    ),
    Azkar(
      count: ' ثلاث مرات ',
      countInt: 3,
      zekr:
          'قُلْ أَعُوذُ بِرَبِّ ٱلْفَلَقِ، مِن شَرِّ مَا خَلَقَ، وَمِن شَرِّ غَاسِقٍ إِذَا وَقَبَ، وَمِن شَرِّ ٱلنَّفَّٰثَٰتِ فِى ٱلْعُقَدِ، وَمِن شَرِّ حَاسِدٍ إِذَا حَسَدَ.',
      description:
          "من قالها حين يصبح وحين يمسى كفته من كل شىء (الإخلاص والمعوذتين).",
      reference: "سورة الفلق",
      audioPath: "assets/azkaraudio/zekr (3).mp3",
    ),
    Azkar(
      count: ' ثلاث مرات ',
      countInt: 3,
      zekr:
          'قُلْ أَعُوذُ بِرَبِّ ٱلنَّاسِ، مَلِكِ ٱلنَّاسِ، إِلَٰهِ ٱلنَّاسِ، مِن شَرِّ ٱلْوَسْوَاسِ ٱلْخَنَّاسِ، ٱلَّذِى يُوَسْوِسُ فِى صُدُورِ ٱلنَّاسِ، مِنَ ٱلْجِنَّةِ وَٱلنَّاسِ.',
      description:
          "من قالها حين يصبح وحين يمسى كفته من كل شىء (الإخلاص والمعوذتين).",
      reference: "سورة الناس",
      audioPath: "assets/azkaraudio/zekr (4).mp3",
    ),
    // --- تكملة الأذكار حسب ترتيب الداتا المُدخلة (من ذِكر 'أمسينا وأمسى الملك لله' إلى آخر ذكر)
    Azkar(
      count: ' مرة واحدة ',
      countInt: 1,
      zekr:
          'أَمْسَيْـنا وَأَمْسـى المـلكُ لله وَالحَمدُ لله ، لا إلهَ إلاّ اللّهُ وَحدَهُ لا شَريكَ لهُ، لهُ المُـلكُ ولهُ الحَمْـد، وهُوَ على كلّ شَيءٍ قدير ، رَبِّ أسْـأَلُـكَ خَـيرَ ما في هـذهِ اللَّـيْلَةِ وَخَـيرَ ما بَعْـدَهـا ، وَأَعـوذُ بِكَ مِنْ شَـرِّ ما في هـذهِ اللَّـيْلةِ وَشَرِّ ما بَعْـدَهـا ، رَبِّ أَعـوذُبِكَ مِنَ الْكَسَـلِ وَسـوءِ الْكِـبَر ، رَبِّ أَعـوذُ بِكَ مِنْ عَـذابٍ في النّـارِ وَعَـذابٍ في القَـبْر.',
      reference: "صحيح مسلم",
      description: "",
      audioPath: "assets/azkaraudio/zekr (12).mp3",
    ),
    Azkar(
      count: ' مرة واحدة ',
      countInt: 1,
      zekr:
          'اللّهـمَّ أَنْتَ رَبِّـي لا إلهَ إلاّ أَنْتَ ، خَلَقْتَنـي وَأَنا عَبْـدُك ، وَأَنا عَلـى عَهْـدِكَ وَوَعْـدِكَ ما اسْتَـطَعْـت ، أَعـوذُبِكَ مِنْ شَـرِّ ما صَنَـعْت ، أَبـوءُ لَـكَ بِنِعْـمَتِـكَ عَلَـيَّ وَأَبـوءُ بِذَنْـبي فَاغْفـِرْ لي فَإِنَّـهُ لا يَغْـفِرُ الذُّنـوبَ إِلاّ أَنْتَ .',
      description:
          "من قالها موقنا بها حين يمسى ومات من ليلته دخل الجنة وكذلك حين يصبح.",
      reference: "صحيح البخاري",
      audioPath: "assets/azkaraudio/zekr (5).mp3",
    ),
    Azkar(
      count: ' ثلاث مرات ',
      countInt: 3,
      zekr:
          'رَضيـتُ بِاللهِ رَبَّـاً وَبِالإسْلامِ ديـناً وَبِمُحَـمَّدٍ صلى الله عليه وسلم نَبِيّـاً.',
      description:
          "من قالها حين يصبح وحين يمسى كان حقا على الله أن يرضيه يوم القيامة.",
      reference: "الإمام أحمد",
      audioPath: "assets/azkaraudio/zekr (16).mp3",
    ),
    Azkar(
      count: ' اربع مرات ',
      countInt: 4,
      zekr:
          'اللّهُـمَّ إِنِّـي أَمسيتُ أُشْـهِدُك ، وَأُشْـهِدُ حَمَلَـةَ عَـرْشِـك ، وَمَلَائِكَتَكَ ، وَجَمـيعَ خَلْـقِك ، أَنَّـكَ أَنْـتَ اللهُ لا إلهَ إلاّ أَنْـتَ وَحْـدَكَ لا شَريكَ لَـك ، وَأَنَّ ُ مُحَمّـداً عَبْـدُكَ وَرَسـولُـك.',
      description: "من قالها أعتقه الله من النار.",
      reference: "سنن أبي داود",
      audioPath: "assets/azkaraudio/zekr (7).mp3",
    ),
    Azkar(
      count: ' مرة واحدة ',
      countInt: 1,
      zekr:
          'اللّهُـمَّ ما أَمسى بي مِـنْ نِعْـمَةٍ أَو بِأَحَـدٍ مِـنْ خَلْـقِك ، فَمِـنْكَ وَحْـدَكَ لا شريكَ لَـك ، فَلَـكَ الْحَمْـدُ وَلَـكَ الشُّكْـر.',
      description: "من قالها حين يمسى أدى شكر يومه.",
      reference: "سنن أبي داود",
      audioPath: "assets/azkaraudio/zekr (9).mp3",
    ),
    Azkar(
      count: ' سبع مرات ',
      countInt: 7,
      zekr:
          'حَسْبِـيَ اللّهُ لا إلهَ إلاّ هُوَ عَلَـيهِ تَوَكَّـلتُ وَهُوَ رَبُّ العَرْشِ العَظـيم.',
      description: "من قالها كفاه الله ما أهمه من أمر الدنيا والأخرة.",
      reference: "ابن السني",
      audioPath: "assets/azkaraudio/zekr (11).mp3",
    ),
    Azkar(
      count: ' ثلاث مرات ',
      countInt: 3,
      zekr:
          'بِسـمِ اللهِ الذي لا يَضُـرُّ مَعَ اسمِـهِ شَيءٌ في الأرْضِ وَلا في السّمـاءِ وَهـوَ السّمـيعُ العَلـيم.',
      description: "لم يضره من الله شيء.",
      reference: "سنن ابن ماجه",
      audioPath: "assets/azkaraudio/zekr (14).mp3",
    ),
    Azkar(
      count: ' مرة واحدة ',
      countInt: 1,
      zekr:
          'اللّهُـمَّ بِكَ أَمْسَـينا وَبِكَ أَصْـبَحْنا، وَبِكَ نَحْـيا وَبِكَ نَمُـوتُ وَإِلَـيْكَ الْمَصِيرُ.',
      description: "",
      reference: "سنن الترمذي",
      audioPath: "assets/azkaraudio/zekr (6).mp3",
    ),
    Azkar(
      count: ' مرة واحدة ',
      countInt: 1,
      zekr:
          'أَمْسَيْنَا عَلَى فِطْرَةِ الإسْلاَمِ، وَعَلَى كَلِمَةِ الإِخْلاَصِ، وَعَلَى دِينِ نَبِيِّنَا مُحَمَّدٍ صَلَّى اللهُ عَلَيْهِ وَسَلَّمَ، وَعَلَى مِلَّةِ أَبِينَا إبْرَاهِيمَ حَنِيفاً مُسْلِماً وَمَا كَانَ مِنَ المُشْرِكِينَ.',
      description: "",
      reference: "الإمام أحمد",
      audioPath: "assets/azkaraudio/zekr (18).mp3",
    ),
    Azkar(
      count: ' ثلاث مرات ',
      countInt: 3,
      zekr:
          'سُبْحـانَ اللهِ وَبِحَمْـدِهِ عَدَدَ خَلْـقِه ، وَرِضـا نَفْسِـه ، وَزِنَـةَ عَـرْشِـه ، وَمِـدادَ كَلِمـاتِـه.',
      description: "",
      reference: "صحيح مسلم",
      audioPath: "assets/azkaraudio/zekr (19).mp3",
    ),
    Azkar(
      count: ' ثلاث مرات ',
      countInt: 3,
      zekr:
          'اللّهُـمَّ عافِـني في بَدَنـي ، اللّهُـمَّ عافِـني في سَمْـعي ، اللّهُـمَّ عافِـني في بَصَـري ، لا إلهَ إلاّ أَنْـتَ ، اللّهُـمَّ إِنّـي أَعـوذُ بِكَ مِنَ الْكُـفر ، وَالفَـقْر ، وَأَعـوذُ بِكَ مِنْ عَذابِ القَـبْر ، لا إلهَ إلاّ أَنْـتَ.',
      description: "",
      reference: "",
      audioPath: "assets/azkaraudio/zekr (10).mp3",
    ),
    Azkar(
      count: ' مرة واحدة ',
      countInt: 1,
      zekr:
          'اللّهُـمَّ إِنِّـي أسْـأَلُـكَ العَـفْوَ وَالعـافِـيةَ في الدُّنْـيا وَالآخِـرَة ، اللّهُـمَّ إِنِّـي أسْـأَلُـكَ العَـفْوَ وَالعـافِـيةَ في ديني وَدُنْـيايَ وَأهْـلي وَمالـي ، اللّهُـمَّ اسْتُـرْ عـوْراتي وَآمِـنْ رَوْعاتـي ، اللّهُـمَّ احْفَظْـني مِن بَـينِ يَدَيَّ وَمِن خَلْفـي وَعَن يَمـيني وَعَن شِمـالي ، وَمِن فَوْقـي ، وَأَعـوذُ بِعَظَمَـتِكَ أَن أُغْـتالَ مِن تَحْتـي.',
      description: "",
      reference: "سنن ابن ماجه",
      audioPath: "assets/azkaraudio/zekr (13).mp3",
    ),
    Azkar(
      count: ' ثلاث مرات ',
      countInt: 3,
      zekr:
          'يَا حَيُّ يَا قيُّومُ بِرَحْمَتِكَ أسْتَغِيثُ أصْلِحْ لِي شَأنِي كُلَّهُ وَلاَ تَكِلْنِي إلَى نَفْسِي طَـرْفَةَ عَيْنٍ.',
      description: "",
      reference: "(المستدرك على الصحيحين)الحاكم",
      audioPath: "assets/azkaraudio/zekr (8).mp3",
    ),
    Azkar(
      count: ' مرة واحدة ',
      countInt: 1,
      zekr:
          'أَمْسَيْنا وَأَمْسَى الْمُلْكُ للهِ رَبِّ الْعَالَمَيْنِ، اللَّهُمَّ إِنَّي أسْأَلُكَ خَيْرَ هَذَه اللَّيْلَةِ فَتْحَهَا ونَصْرَهَا، ونُوْرَهَا وبَرَكَتهَا، وَهُدَاهَا، وَأَعُوذُ بِكَ مِنْ شَرِّ مَا فيهِا وَشَرَّ مَا بَعْدَهَا.',
      description: "",
      reference: "سنن أبي داود",
      audioPath: "",
    ),
    Azkar(
      count: ' مرة واحدة ',
      countInt: 1,
      zekr:
          'اللّهُـمَّ عالِـمَ الغَـيْبِ وَالشّـهادَةِ فاطِـرَ السّماواتِ وَالأرْضِ رَبَّ كـلِّ شَـيءٍ وَمَليـكَه ، أَشْهَـدُ أَنْ لا إِلـهَ إِلاّ أَنْت ، أَعـوذُ بِكَ مِن شَـرِّ نَفْسـي وَمِن شَـرِّ الشَّيْـطانِ وَشِرْكِهِ ، وَأَنْ أَقْتَـرِفَ عَلـى نَفْسـي سوءاً أَوْ أَجُـرَّهُ إِلـى مُسْـلِم.',
      description: "",
      reference: "سنن الترمذي",
      audioPath: "",
    ),
    Azkar(
      count: ' ثلاث مرات ',
      countInt: 3,
      zekr: 'أَعـوذُ بِكَلِمـاتِ اللّهِ التّـامّـاتِ مِنْ شَـرِّ ما خَلَـق.',
      description: "",
      reference: "",
      audioPath: "",
    ),
    Azkar(
      count: ' عشر مرات ',
      countInt: 10,
      zekr: 'اللَّهُمَّ صَلِّ وَسَلِّمْ وَبَارِكْ على نَبِيِّنَا مُحمَّد.',
      description: "من صلى على حين يصبح وحين يمسى ادركته شفاعتى يوم القيامة.",
      reference: "الطبراني",
      audioPath: "assets/azkaraudio/zekr (15).mp3",
    ),
    Azkar(
      count: ' ثلاث مرات ',
      countInt: 3,
      zekr:
          'اللَّهُمَّ إِنَّا نَعُوذُ بِكَ مِنْ أَنْ نُشْرِكَ بِكَ شَيْئًا نَعْلَمُهُ ، وَنَسْتَغْفِرُكَ لِمَا لَا نَعْلَمُهُ.',
      description: "",
      reference: "",
      audioPath: "",
    ),
    Azkar(
      count: ' ثلاث مرات ',
      countInt: 3,
      zekr:
          'اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنْ الْهَمِّ وَالْحَزَنِ، وَأَعُوذُ بِكَ مِنْ الْعَجْزِ وَالْكَسَلِ، وَأَعُوذُ بِكَ مِنْ الْجُبْنِ وَالْبُخْلِ، وَأَعُوذُ بِكَ مِنْ غَلَبَةِ الدَّيْنِ، وَقَهْرِ الرِّجَالِ.',
      description: "",
      reference: "سنن أبي داود",
      audioPath: "",
    ),
    Azkar(
      count: ' ثلاث مرات ',
      countInt: 3,
      zekr:
          'أسْتَغْفِرُ اللهَ العَظِيمَ الَّذِي لاَ إلَهَ إلاَّ هُوَ، الحَيُّ القَيُّومُ، وَأتُوبُ إلَيهِ.',
      description: "",
      reference: "",
      audioPath: "",
    ),
    Azkar(
      count: ' ثلاث مرات ',
      countInt: 3,
      zekr:
          'يَا رَبِّ , لَكَ الْحَمْدُ كَمَا يَنْبَغِي لِجَلَالِ وَجْهِكَ , وَلِعَظِيمِ سُلْطَانِكَ.',
      description: "",
      reference: "",
      audioPath: "",
    ),
    Azkar(
      count: 'مائة مرة',
      countInt: 100,
      zekr:
          'لَا إلَه إلّا اللهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ وَهُوَ عَلَى كُلِّ شَيْءِ قَدِيرِ.',
      reference: 'البخاري و مسلم',
      description:
          'كانت له عدل عشر رقاب، وكتبت له مئة حسنة، ومحيت عنه مئة سيئة، وكانت له حرزا من الشيطان.',
      audioPath: "",
    ),
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr:
          'اللَّهُمَّ أَنْتَ رَبِّي لا إِلَهَ إِلا أَنْتَ ، عَلَيْكَ تَوَكَّلْتُ ، وَأَنْتَ رَبُّ الْعَرْشِ الْعَظِيمِ , مَا شَاءَ اللَّهُ كَانَ ، وَمَا لَمْ يَشَأْ لَمْ يَكُنْ ، وَلا حَوْلَ وَلا قُوَّةَ إِلا بِاللَّهِ الْعَلِيِّ الْعَظِيمِ , أَعْلَمُ أَنَّ اللَّهَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ ، وَأَنَّ اللَّهَ قَدْ أَحَاطَ بِكُلِّ شَيْءٍ عِلْمًا , اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنْ شَرِّ نَفْسِي ، وَمِنْ شَرِّ كُلِّ دَابَّةٍ أَنْتَ آخِذٌ بِنَاصِيَتِهَا ، إِنَّ رَبِّي عَلَى صِرَاطٍ مُسْتَقِيمٍ.',
      description: 'ذكر طيب.',
      audioPath: "",
    ),
    Azkar(
      count: 'مائة مرة',
      countInt: 100,
      zekr: 'سُبْحـانَ اللهِ وَبِحَمْـدِهِ.',
      reference: 'صحيح مسلم',
      description:
          'حُطَّتْ خَطَايَاهُ وَإِنْ كَانَتْ مِثْلَ زَبَدِ الْبَحْرِ. لَمْ يَأْتِ أَحَدٌ يَوْمَ الْقِيَامَةِ بِأَفْضَلَ مِمَّا جَاءَ بِهِ إِلَّا أَحَدٌ قَالَ مِثْلَ مَا قَالَ أَوْ زَادَ عَلَيْهِ.',
      audioPath: "",
    ),
  ];

  // 🕌 أذكار ما بعد الصلاة (أمثلة إضافية شائعة)
  static final List<Azkar> afterPrayerAzkar = [
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr:
          'أَسْتَغْفِرُ اللَّهَ (ثلاث مرات) . اللَّهُمَّ أَنْتَ السَّلَامُ وَمِنْكَ السَّلَامُ، تَبَارَكْتَ يَا ذَا الْجَلَالِ وَالْإِكْرَامِ.',
      reference: 'صحيح مسلم',
      description: null,
    ),
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr:
          'لَا إِلَهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ وَهُوَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ. اللَّهُمَّ لَا مَانِعَ لِمَا أَعْطَيْتَ، وَلَا مُعْطِيَ لِمَا مَنَعْتَ، وَلَا يَنْفَعُ ذَا الْجَدِّ مِنْكَ الْجَدُّ.',
      reference: 'صحيح البخاري',
      description: null,
    ),
    Azkar(
      count: 'عشر مرات (بعد الفجر والمغرب)',
      countInt: 10,
      zekr:
          'لَا إِلَهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ يُحْيِي وَيُمِيتُ وَهُوَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ.',
      reference: 'سنن الترمذي',
      description: null,
    ),
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr:
          'اللَّهُمَّ أَعِنِّي عَلَى ذِكْرِكَ، وَشُكْرِكَ، وَحُسْنِ عِبَادَتِكَ.',
      reference: 'سنن أبي داود',
      description: null,
    ),
    Azkar(
      count: '33 مرة',
      countInt: 33,
      zekr: 'سُبْحَانَ اللَّهِ',
      reference: 'صحيح مسلم',
      description: null,
    ),
    Azkar(
      count: '33 مرة',
      countInt: 33,
      zekr: 'الْحَمْدُ لِلَّهِ',
      reference: 'صحيح مسلم',
      description: null,
    ),
    Azkar(
      count: '33 مرة',
      countInt: 33,
      zekr: 'اللَّهُ أَكْبَرُ',
      reference: 'صحيح مسلم',
      description:
          'ثم يقول تمام المائة: لَا إِلَهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ وَهُوَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ.',
    ),
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr: 'اللَّهُ لَا إِلَهَ إِلَّا هُوَ الْحَيُّ الْقَيُّومُ...',
      reference: 'آية الكرسي',
      description: 'من قرأها دبر كل صلاة لم يمنعه من دخول الجنة إلا أن يموت.',
    ),
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr: 'قُلْ هُوَ ٱللَّهُ أَحَدٌ...',
      reference: 'سورة الإخلاص',
      description: 'تُقرأ مرة بعد كل صلاة (وثلاث مرات بعد الفجر والمغرب).',
    ),
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr: 'قُلْ أَعُوذُ بِرَبِّ ٱلْفَلَقِ...',
      reference: 'سورة الفلق',
      description: 'تُقرأ مرة بعد كل صلاة (وثلاث مرات بعد الفجر والمغرب).',
    ),
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr: 'قُلْ أَعُوذُ بِرَبِّ ٱلنَّاسِ...',
      reference: 'سورة الناس',
      description: 'تُقرأ مرة بعد كل صلاة (وثلاث مرات بعد الفجر والمغرب).',
    ),
  ];

  // ✈️ أذكار السفر (أمثلة إضافية شائعة)
  static final List<Azkar> travelAzkar = [
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr:
          'اللَّهُ أَكْبَرُ، اللَّهُ أَكْبَرُ، اللَّهُ أَكْبَرُ، سُبْحَانَ الَّذِي سَخَّرَ لَنَا هَذَا وَمَا كُنَّا لَهُ مُقْرِنِينَ، وَإِنَّا إِلَى رَبِّنَا لَمُنْقَلِبُونَ. اللَّهُمَّ إِنَّا نَسْأَلُكَ فِي سَفَرِنَا هَذَا الْبِرَّ وَالتَّقْوَى، وَمِنَ الْعَمَلِ مَا تَرْضَى، اللَّهُمَّ هَوِّنْ عَلَيْنَا سَفَرَنَا هَذَا، وَاطْوِ عَنَّا بُعْدَهُ، اللَّهُمَّ أَنْتَ الصَّاحِبُ فِي السَّفَرِ، وَالْخَلِيفَةُ فِي الْأَهْلِ، اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنْ وَعْثَاءِ السَّفَرِ، وَكَآبَةِ الْمَنْظَرِ، وَسُوءِ الْمُنْقَلَبِ فِي الْمَالِ وَالْأَهْلِ.',
      reference: 'صحيح مسلم',
      description: 'دعاء السفر',
    ),
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr: 'آيِبُونَ تَائِبُونَ عَابِدُونَ لِرَبِّنَا حَامِدُونَ.',
      reference: 'صحيح مسلم',
      description: 'دعاء الرجوع من السفر',
    ),
  ];

  // 🥘 أذكار الطعام (أمثلة إضافية شائعة)
  static final List<Azkar> eatingAzkar = [
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr: 'بِسْمِ اللَّهِ.',
      reference: 'صحيح مسلم',
      description: 'عند البدء في الأكل',
    ),
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr: 'بِسْمِ اللَّهِ أَوَّلَهُ وَآخِرَهُ.',
      reference: 'سنن أبي داود، صحيح الجامع',
      description: 'إذا نسي التسمية في أوله ثم تذكر',
    ),
    Azkar(
      count: 'مرة واحدة',
      countInt: 1,
      zekr:
          'الْحَمْدُ لِلَّهِ الَّذِي أَطْعَمَنِي هَذَا، وَرَزَقَنِيهِ مِنْ غَيْرِ حَوْلٍ مِنِّي وَلَا قُوَّةٍ.',
      reference: 'سنن الترمذي',
      description: 'دعاء بعد الفراغ من الطعام',
    ),
  ];

  // 🔑 دالة مساعدة لإنشاء قائمة Azkar من قائمة JSON
  static List<Azkar> fromJsonList(List<Map<String, dynamic>> jsonList) {
    return jsonList.map((json) => Azkar.fromJson(json)).toList();
  }
}
import 'package:flutter/material.dart';
import 'package:najatak/widgets/azkar_category_widget.dart';
import 'package:najatak/widgets/azkar_details_sheet.dart';
import 'package:shared_preferences/shared_preferences.dart';

import '../models/azkar_model.dart';
import '../services/notification_service.dart';

class AzkarScreen extends StatefulWidget {
  const AzkarScreen({super.key});

  @override
  State<AzkarScreen> createState() => _AzkarScreenState();
}

class _AzkarScreenState extends State<AzkarScreen>
    with SingleTickerProviderStateMixin {
  bool morningNotificationEnabled = false;
  bool eveningNotificationEnabled = false;
  bool sleepNotificationEnabled = false;

  TimeOfDay morningTime = const TimeOfDay(hour: 6, minute: 0);
  TimeOfDay eveningTime = const TimeOfDay(hour: 16, minute: 30);
  TimeOfDay sleepTime = const TimeOfDay(hour: 22, minute: 0);

  late AnimationController _animationController;

  @override
  void initState() {
    super.initState();
    _loadSettings();
    _animationController = AnimationController(
      vsync: this,
      duration: const Duration(milliseconds: 300),
    );
  }

  @override
  void dispose() {
    _animationController.dispose();
    super.dispose();
  }

  Future<void> _loadSettings() async {
    final prefs = await SharedPreferences.getInstance();
    setState(() {
      morningNotificationEnabled =
          prefs.getBool('morning_notification') ?? false;
      eveningNotificationEnabled =
          prefs.getBool('evening_notification') ?? false;
      sleepNotificationEnabled = prefs.getBool('sleep_notification') ?? false;

      morningTime = TimeOfDay(
        hour: prefs.getInt('morning_hour') ?? 6,
        minute: prefs.getInt('morning_minute') ?? 0,
      );
      eveningTime = TimeOfDay(
        hour: prefs.getInt('evening_hour') ?? 16,
        minute: prefs.getInt('evening_minute') ?? 30,
      );
      sleepTime = TimeOfDay(
        hour: prefs.getInt('sleep_hour') ?? 22,
        minute: prefs.getInt('sleep_minute') ?? 0,
      );
    });
  }

  Future<void> _selectTime(
    BuildContext context,
    TimeOfDay initialTime,
    Function(TimeOfDay) onTimeSelected,
  ) async {
    final TimeOfDay? picked = await showTimePicker(
      context: context,
      initialTime: initialTime,
      builder: (context, child) {
        return Theme(
          data: Theme.of(context).copyWith(
            timePickerTheme: TimePickerThemeData(
              backgroundColor: Colors.white,
              hourMinuteShape: RoundedRectangleBorder(
                borderRadius: BorderRadius.circular(15),
              ),
            ),
          ),
          child: MediaQuery(
            data: MediaQuery.of(context).copyWith(alwaysUse24HourFormat: false),
            child: child!,
          ),
        );
      },
    );

    if (picked != null) {
      onTimeSelected(picked);
    }
  }

  Future<void> _toggleMorningNotification(bool value) async {
    if (value) {
      await _selectTime(context, morningTime, (picked) async {
        final prefs = await SharedPreferences.getInstance();
        await prefs.setBool('morning_notification', true);
        await prefs.setInt('morning_hour', picked.hour);
        await prefs.setInt('morning_minute', picked.minute);

        // استخدام NotificationType.morning
        await NotificationService.scheduleDailyNotification(
          id: 100,
          title: 'أذكار الصباح',
          body: 'حان وقت أذكار الصباح',
          hour: picked.hour,
          minute: picked.minute,
          type: NotificationType.morning,
        );

        setState(() {
          morningTime = picked;
          morningNotificationEnabled = true;
        });

        if (mounted) {
          _showSuccessSnackBar(
            'تم تفعيل تنبيه أذكار الصباح الساعة ${picked.format(context)}',
          );
        }
      });
    } else {
      final prefs = await SharedPreferences.getInstance();
      await prefs.setBool('morning_notification', false);
      await NotificationService.cancelNotification(100);

      setState(() {
        morningNotificationEnabled = false;
      });

      if (mounted) {
        _showInfoSnackBar('تم إلغاء تنبيه أذكار الصباح');
      }
    }
  }

  Future<void> _toggleEveningNotification(bool value) async {
    if (value) {
      await _selectTime(context, eveningTime, (picked) async {
        final prefs = await SharedPreferences.getInstance();
        await prefs.setBool('evening_notification', true);
        await prefs.setInt('evening_hour', picked.hour);
        await prefs.setInt('evening_minute', picked.minute);

        await NotificationService.scheduleDailyNotification(
          id: 101,
          title: 'أذكار المساء',
          body: 'حان وقت أذكار المساء',
          hour: picked.hour,
          minute: picked.minute,
          type: NotificationType.evening,
        );

        setState(() {
          eveningTime = picked;
          eveningNotificationEnabled = true;
        });

        if (mounted) {
          _showSuccessSnackBar(
            'تم تفعيل تنبيه أذكار المساء الساعة ${picked.format(context)}',
          );
        }
      });
    } else {
      final prefs = await SharedPreferences.getInstance();
      await prefs.setBool('evening_notification', false);
      await NotificationService.cancelNotification(101);

      setState(() {
        eveningNotificationEnabled = false;
      });

      if (mounted) {
        _showInfoSnackBar('تم إلغاء تنبيه أذكار المساء');
      }
    }
  }

  Future<void> _toggleSleepNotification(bool value) async {
    if (value) {
      await _selectTime(context, sleepTime, (picked) async {
        final prefs = await SharedPreferences.getInstance();
        await prefs.setBool('sleep_notification', true);
        await prefs.setInt('sleep_hour', picked.hour);
        await prefs.setInt('sleep_minute', picked.minute);

        await NotificationService.scheduleDailyNotification(
          id: 102,
          title: 'أذكار النوم',
          body: 'لا تنسى أذكار النوم قبل أن تنام',
          hour: picked.hour,
          minute: picked.minute,
          type: NotificationType.sleep,
        );

        setState(() {
          sleepTime = picked;
          sleepNotificationEnabled = true;
        });

        if (mounted) {
          _showSuccessSnackBar(
            'تم تفعيل تنبيه أذكار النوم الساعة ${picked.format(context)}',
          );
        }
      });
    } else {
      final prefs = await SharedPreferences.getInstance();
      await prefs.setBool('sleep_notification', false);
      await NotificationService.cancelNotification(102);

      setState(() {
        sleepNotificationEnabled = false;
      });

      if (mounted) {
        _showInfoSnackBar('تم إلغاء تنبيه أذكار النوم');
      }
    }
  }

  Future<void> _changeTime(String type) async {
    TimeOfDay initialTime;
    int notificationId;
    String title;
    String body;
    NotificationType notifType;

    switch (type) {
      case 'morning':
        initialTime = morningTime;
        notificationId = 100;
        title = 'أذكار الصباح';
        body = 'حان وقت أذكار الصباح';
        notifType = NotificationType.morning;
        break;
      case 'evening':
        initialTime = eveningTime;
        notificationId = 101;
        title = 'أذكار المساء';
        body = 'حان وقت أذكار المساء';
        notifType = NotificationType.evening;
        break;
      case 'sleep':
        initialTime = sleepTime;
        notificationId = 102;
        title = 'أذكار النوم';
        body = 'لا تنسى أذكار النوم قبل أن تنام';
        notifType = NotificationType.sleep;
        break;
      default:
        return;
    }

    await _selectTime(context, initialTime, (picked) async {
      final prefs = await SharedPreferences.getInstance();
      await prefs.setInt('${type}_hour', picked.hour);
      await prefs.setInt('${type}_minute', picked.minute);

      await NotificationService.cancelNotification(notificationId);
      await NotificationService.scheduleDailyNotification(
        id: notificationId,
        title: title,
        body: body,
        hour: picked.hour,
        minute: picked.minute,
        type: notifType,
      );

      setState(() {
        switch (type) {
          case 'morning':
            morningTime = picked;
            break;
          case 'evening':
            eveningTime = picked;
            break;
          case 'sleep':
            sleepTime = picked;
            break;
        }
      });

      if (mounted) {
        _showSuccessSnackBar('تم تغيير الوقت إلى ${picked.format(context)}');
      }
    });
  }

  void _showSuccessSnackBar(String message) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Row(
          children: [
            const Icon(Icons.check_circle, color: Colors.white),
            const SizedBox(width: 12),
            Expanded(child: Text(message)),
          ],
        ),
        backgroundColor: Colors.green,
        behavior: SnackBarBehavior.floating,
        shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(10)),
        margin: const EdgeInsets.all(16),
        duration: const Duration(seconds: 3),
      ),
    );
  }

  void _showInfoSnackBar(String message) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Row(
          children: [
            const Icon(Icons.info_outline, color: Colors.white),
            const SizedBox(width: 12),
            Expanded(child: Text(message)),
          ],
        ),
        backgroundColor: Colors.blue,
        behavior: SnackBarBehavior.floating,
        shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(10)),
        margin: const EdgeInsets.all(16),
      ),
    );
  }

  void _showAzkarDetails(Azkar azkar, Color color, Gradient gradient) {
    showModalBottomSheet(
      context: context,
      isScrollControlled: true,
      backgroundColor: Colors.transparent,
      builder: (context) =>
          AzkarDetailsSheet(azkar: azkar, color: color, gradient: gradient),
    );
  }

  PreferredSizeWidget _buildAppBar() {
    return AppBar(
      title: const Text(
        'الأذكار',
        style: TextStyle(fontSize: 28, fontWeight: FontWeight.bold),
      ),
      elevation: 0,
      leading: InkWell(
        onTap: () {
          Navigator.pop(context);
        },
        child: const Icon(Icons.arrow_back_ios),
      ),
      flexibleSpace: Container(
        decoration: BoxDecoration(
          gradient: LinearGradient(
            colors: [
              Theme.of(context).primaryColor,
              Theme.of(context).primaryColor.withAlpha(204),
            ],
          ),
        ),
      ),
    );
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: _buildAppBar(),
      body: ListView(
        padding: const EdgeInsets.all(16),
        children: [
          AzkarCategoryWidget(
            title: 'أذكار الصباح',
            subtitle: 'ابدأ يومك بالذكر والدعاء',
            icon: Icons.wb_sunny,
            color: Colors.orange,
            gradient: const LinearGradient(
              colors: [Color(0xFFFFA726), Color(0xFFFF6F00)],
            ),
            azkarList: AzkarData.morningAzkar,
            notificationEnabled: morningNotificationEnabled,
            onNotificationToggle: _toggleMorningNotification,
            currentTime: morningTime,
            onChangeTime: () => _changeTime('morning'),
            onAzkarItemTap: _showAzkarDetails,
          ),
          const SizedBox(height: 16),
          AzkarCategoryWidget(
            title: 'أذكار المساء',
            subtitle: 'اختم نهارك بذكر الله',
            icon: Icons.nights_stay,
            color: Colors.indigo,
            gradient: const LinearGradient(
              colors: [Color(0xFF5C6BC0), Color(0xFF283593)],
            ),
            azkarList: AzkarData.eveningAzkar,
            notificationEnabled: eveningNotificationEnabled,
            onNotificationToggle: _toggleEveningNotification,
            currentTime: eveningTime,
            onChangeTime: () => _changeTime('evening'),
            onAzkarItemTap: _showAzkarDetails,
          ),
          const SizedBox(height: 16),
          AzkarCategoryWidget(
            title: 'أذكار النوم',
            subtitle: 'استعد لنوم هادئ مطمئن',
            icon: Icons.bedtime,
            color: Colors.purple,
            gradient: const LinearGradient(
              colors: [Color(0xFF9C27B0), Color(0xFF4A148C)],
            ),
            azkarList: AzkarData.sleepAzkar,
            notificationEnabled: sleepNotificationEnabled,
            onNotificationToggle: _toggleSleepNotification,
            currentTime: sleepTime,
            onChangeTime: () => _changeTime('sleep'),
            onAzkarItemTap: _showAzkarDetails,
          ),
          const SizedBox(height: 16),
          AzkarCategoryWidget(
            title: 'أذكار بعد الصلاة',
            subtitle: 'أذكار وأدعية دبر الصلوات',
            icon: Icons.mosque,
            color: Colors.teal,
            gradient: const LinearGradient(
              colors: [Color(0xFF26A69A), Color(0xFF00695C)],
            ),
            azkarList: AzkarData.afterPrayerAzkar,
            onAzkarItemTap: _showAzkarDetails,
          ),
          const SizedBox(height: 16),
          AzkarCategoryWidget(
            title: 'أذكار السفر',
            subtitle: 'دعاء السفر والرجوع',
            icon: Icons.flight_takeoff,
            color: Colors.blue,
            gradient: const LinearGradient(
              colors: [Color(0xFF42A5F5), Color(0xFF1565C0)],
            ),
            azkarList: AzkarData.travelAzkar,
            onAzkarItemTap: _showAzkarDetails,
          ),
          const SizedBox(height: 16),
          AzkarCategoryWidget(
            title: 'أذكار الطعام',
            subtitle: 'أذكار قبل وبعد الطعام',
            icon: Icons.restaurant,
            color: Colors.brown,
            gradient: const LinearGradient(
              colors: [Color(0xFF8D6E63), Color(0xFF5D4037)],
            ),
            azkarList: AzkarData.eatingAzkar,
            onAzkarItemTap: _showAzkarDetails,
          ),
        ],
      ),
    );
  }
}
import 'package:flutter/material.dart';

import 'azkar_screen.dart';
import 'settings_screen.dart';

class HomeScreen extends StatelessWidget {
  const HomeScreen({super.key});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text(
          'نَجَاتَك',
          style: TextStyle(fontSize: 32, fontWeight: FontWeight.bold),
        ),
        actions: [
          IconButton(
            icon: const Icon(Icons.edit_notifications),
            onPressed: () => Navigator.push(
              context,
              MaterialPageRoute(builder: (context) => const SettingsScreen()),
            ),
            tooltip: 'الإعدادات',
          ),
        ],
      ),
      body: Padding(
        padding: const EdgeInsets.all(16.0),
        child: GridView.count(
          crossAxisCount: 2,
          crossAxisSpacing: 16,
          mainAxisSpacing: 16,
          children: [
            _buildFeatureCard(
              context,
              title: 'الأذكار',
              icon: Icons.favorite,
              color: const Color(0xFF2E7D32),
              onTap: () => Navigator.push(
                context,
                MaterialPageRoute(builder: (context) => const AzkarScreen()),
              ),
            ),
            _buildFeatureCard(
              context,
              title: 'مواقيت\nالصلاة',
              icon: Icons.access_time,
              color: const Color(0xFF1565C0),
              onTap: () {
                ScaffoldMessenger.of(context).showSnackBar(
                  const SnackBar(content: Text('قريباً إن شاء الله')),
                );
              },
            ),
            _buildFeatureCard(
              context,
              title: 'اتجاه\nالقبلة',
              icon: Icons.explore,
              color: const Color(0xFFD84315),
              onTap: () {
                ScaffoldMessenger.of(context).showSnackBar(
                  const SnackBar(content: Text('قريباً إن شاء الله')),
                );
              },
            ),
            _buildFeatureCard(
              context,
              title: 'القرآن\nالكريم',
              icon: Icons.menu_book,
              color: const Color(0xFF6A1B9A),
              onTap: () {
                ScaffoldMessenger.of(context).showSnackBar(
                  const SnackBar(content: Text('قريباً إن شاء الله')),
                );
              },
            ),
          ],
        ),
      ),
    );
  }

  Widget _buildFeatureCard(
    BuildContext context, {
    required String title,
    required IconData icon,
    required Color color,
    required VoidCallback onTap,
  }) {
    return Card(
      elevation: 4,
      shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(20)),
      child: InkWell(
        onTap: onTap,
        borderRadius: BorderRadius.circular(20),
        child: Container(
          decoration: BoxDecoration(
            borderRadius: BorderRadius.circular(20),
            gradient: LinearGradient(
              begin: Alignment.topLeft,
              end: Alignment.bottomRight,
              colors: [color, color.withAlpha(179)],
            ),
          ),
          child: Column(
            mainAxisAlignment: MainAxisAlignment.center,
            children: [
              Icon(icon, size: 60, color: Colors.white),
              const SizedBox(height: 4),
              Text(
                title,
                style: const TextStyle(
                  fontSize: 24,
                  fontWeight: FontWeight.bold,
                  color: Colors.white,
                ),
                textAlign: TextAlign.center,
              ),
            ],
          ),
        ),
      ),
    );
  }
}
import 'package:flutter/material.dart';
import 'package:flutter_local_notifications/flutter_local_notifications.dart';
import 'package:shared_preferences/shared_preferences.dart';

import '../services/notification_service.dart';

class SettingsScreen extends StatefulWidget {
  const SettingsScreen({super.key});

  @override
  State<SettingsScreen> createState() => _SettingsScreenState();
}

class _SettingsScreenState extends State<SettingsScreen>
    with SingleTickerProviderStateMixin {
  List<PendingNotificationRequest> pendingNotifications = [];
  bool isLoading = false;
  late AnimationController _animationController;

  @override
  void initState() {
    super.initState();
    _loadPendingNotifications();
    _animationController = AnimationController(
      vsync: this,
      duration: const Duration(milliseconds: 300),
    );
  }

  @override
  void dispose() {
    _animationController.dispose();
    super.dispose();
  }

  Future<void> _loadPendingNotifications() async {
    setState(() {
      isLoading = true;
    });

    final notifications = await NotificationService.getPendingNotifications();

    setState(() {
      pendingNotifications = notifications;
      isLoading = false;
    });
  }

  Future<void> _cancelNotification(int id) async {
    final notificationName = _getNotificationName(id);

    final confirm = await showDialog<bool>(
      context: context,
      builder: (context) => AlertDialog(
        shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(20)),
        title: Row(
          children: [
            Icon(
              Icons.warning_amber_rounded,
              color: Colors.orange.shade700,
              size: 28,
            ),
            const SizedBox(width: 12),
            const Expanded(child: Text('تأكيد الإلغاء')),
          ],
        ),
        content: Text('هل تريد إلغاء تنبيه "$notificationName"؟'),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context, false),
            child: const Text('لا'),
          ),
          ElevatedButton(
            onPressed: () => Navigator.pop(context, true),
            style: ElevatedButton.styleFrom(
              backgroundColor: Colors.red,
              foregroundColor: Colors.white,
            ),
            child: const Text('نعم، إلغاء'),
          ),
        ],
      ),
    );

    if (confirm == true) {
      await NotificationService.cancelNotification(id);

      // تحديث SharedPreferences
      final prefs = await SharedPreferences.getInstance();
      if (id == 100) {
        await prefs.setBool('morning_notification', false);
      } else if (id == 101) {
        await prefs.setBool('evening_notification', false);
      } else if (id == 102) {
        await prefs.setBool('sleep_notification', false);
      }

      await _loadPendingNotifications();

      if (mounted) {
        _showSuccessSnackBar('تم إلغاء تنبيه "$notificationName"');
      }
    }
  }

  Future<void> _cancelAllNotifications() async {
    if (pendingNotifications.isEmpty) return;

    final confirm = await showDialog<bool>(
      context: context,
      builder: (context) => AlertDialog(
        shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(20)),
        backgroundColor: Colors.red.shade50,
        title: Row(
          children: [
            Icon(Icons.delete_forever, color: Colors.red, size: 28),
            const SizedBox(width: 12),
            const Expanded(child: Text('تأكيد')),
          ],
        ),
        content: Column(
          mainAxisSize: MainAxisSize.min,
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            const Text(
              'هل أنت متأكد من إلغاء جميع الإشعارات المجدولة؟',
              style: TextStyle(fontSize: 16),
            ),
            const SizedBox(height: 16),
            Container(
              padding: const EdgeInsets.all(12),
              decoration: BoxDecoration(
                color: Colors.red.shade100,
                borderRadius: BorderRadius.circular(10),
                border: Border.all(color: Colors.red.shade300),
              ),
              child: Row(
                children: [
                  Icon(Icons.info_outline, color: Colors.red.shade700),
                  const SizedBox(width: 8),
                  Expanded(
                    child: Text(
                      'سيتم إلغاء ${pendingNotifications.length} إشعار',
                      style: TextStyle(
                        color: Colors.red.shade700,
                        fontWeight: FontWeight.bold,
                      ),
                    ),
                  ),
                ],
              ),
            ),
          ],
        ),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context, false),
            child: const Text('إلغاء'),
          ),
          ElevatedButton(
            onPressed: () => Navigator.pop(context, true),
            style: ElevatedButton.styleFrom(
              backgroundColor: Colors.red,
              foregroundColor: Colors.white,
            ),
            child: const Text('نعم، إلغاء الكل'),
          ),
        ],
      ),
    );

    if (confirm == true) {
      await NotificationService.cancelAllNotifications();

      // تحديث SharedPreferences
      final prefs = await SharedPreferences.getInstance();
      await prefs.setBool('morning_notification', false);
      await prefs.setBool('evening_notification', false);
      await prefs.setBool('sleep_notification', false);

      await _loadPendingNotifications();

      if (mounted) {
        _showSuccessSnackBar('تم إلغاء جميع الإشعارات بنجاح');
      }
    }
  }

  void _showSuccessSnackBar(String message) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Row(
          children: [
            const Icon(Icons.check_circle, color: Colors.white),
            const SizedBox(width: 12),
            Expanded(child: Text(message)),
          ],
        ),
        backgroundColor: Colors.green,
        behavior: SnackBarBehavior.floating,
        shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(10)),
        margin: const EdgeInsets.all(16),
      ),
    );
  }

  String _getNotificationName(int id) {
    switch (id) {
      case 100:
        return 'أذكار الصباح';
      case 101:
        return 'أذكار المساء';
      case 102:
        return 'أذكار النوم';
      default:
        return 'إشعار مخصص';
    }
  }

  IconData _getNotificationIcon(int id) {
    switch (id) {
      case 100:
        return Icons.wb_sunny;
      case 101:
        return Icons.nights_stay;
      case 102:
        return Icons.bedtime;
      default:
        return Icons.notifications;
    }
  }

  Color _getNotificationColor(int id) {
    switch (id) {
      case 100:
        return Colors.orange;
      case 101:
        return Colors.indigo;
      case 102:
        return Colors.purple;
      default:
        return Colors.teal;
    }
  }

  String _getNotificationEmoji(int id) {
    switch (id) {
      case 100:
        return '🌅';
      case 101:
        return '🌙';
      case 102:
        return '🌟';
      default:
        return '🔔';
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text(
          'إدارة الإشعارات',
          style: TextStyle(fontSize: 24, fontWeight: FontWeight.bold),
        ),
        elevation: 0,
        leading: IconButton(
          icon: const Icon(Icons.arrow_back_ios),
          onPressed: () => Navigator.pop(context),
        ),
        flexibleSpace: Container(
          decoration: BoxDecoration(
            gradient: LinearGradient(
              colors: [
                Theme.of(context).primaryColor,
                Theme.of(context).primaryColor.withAlpha(204),
              ],
            ),
          ),
        ),
        actions: [
          IconButton(
            icon: const Icon(Icons.refresh_rounded),
            onPressed: () async {
              await _loadPendingNotifications();
              if (mounted) {
                _showSuccessSnackBar('تم تحديث القائمة');
              }
            },
            tooltip: 'تحديث',
          ),
        ],
      ),
      body: isLoading
          ? Center(
              child: Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  CircularProgressIndicator(
                    color: Theme.of(context).primaryColor,
                  ),
                  const SizedBox(height: 16),
                  const Text(
                    'جاري التحميل...',
                    style: TextStyle(fontSize: 16, color: Colors.grey),
                  ),
                ],
              ),
            )
          : RefreshIndicator(
              onRefresh: _loadPendingNotifications,
              child: ListView(
                padding: const EdgeInsets.all(16),
                children: [
                  // إحصائيات سريعة
                  _buildStatisticsCard(),
                  const SizedBox(height: 20),

                  // قائمة الإشعارات المجدولة
                  _buildNotificationsSection(),
                  const SizedBox(height: 20),

                  // قسم الإجراءات السريعة
                  if (pendingNotifications.isNotEmpty) ...[
                    _buildQuickActions(),
                    const SizedBox(height: 20),
                  ],

                  // معلومات مفيدة
                  _buildHelpSection(),
                ],
              ),
            ),
    );
  }

  Widget _buildStatisticsCard() {
    return Card(
      elevation: 8,
      shadowColor: Theme.of(context).primaryColor.withAlpha(51),
      shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(20)),
      child: Container(
        padding: const EdgeInsets.all(20),
        decoration: BoxDecoration(
          borderRadius: BorderRadius.circular(20),
          gradient: LinearGradient(
            begin: Alignment.topLeft,
            end: Alignment.bottomRight,
            colors: [
              Theme.of(context).primaryColor,
              Theme.of(context).primaryColor.withAlpha(204),
            ],
          ),
        ),
        child: Column(
          children: [
            Row(
              children: [
                Container(
                  padding: const EdgeInsets.all(12),
                  decoration: BoxDecoration(
                    color: Colors.white.withAlpha(51),
                    borderRadius: BorderRadius.circular(15),
                  ),
                  child: const Icon(
                    Icons.notifications_active,
                    color: Colors.white,
                    size: 32,
                  ),
                ),
                const SizedBox(width: 16),
                Expanded(
                  child: Column(
                    crossAxisAlignment: CrossAxisAlignment.start,
                    children: [
                      const Text(
                        'الإشعارات النشطة',
                        style: TextStyle(color: Colors.white70, fontSize: 14),
                      ),
                      const SizedBox(height: 4),
                      Text(
                        '${pendingNotifications.length}',
                        style: const TextStyle(
                          color: Colors.white,
                          fontSize: 36,
                          fontWeight: FontWeight.bold,
                        ),
                      ),
                    ],
                  ),
                ),
                Container(
                  padding: const EdgeInsets.symmetric(
                    horizontal: 16,
                    vertical: 8,
                  ),
                  decoration: BoxDecoration(
                    color: pendingNotifications.isEmpty
                        ? Colors.red.withAlpha(179)
                        : Colors.green.withAlpha(179),
                    borderRadius: BorderRadius.circular(20),
                  ),
                  child: Text(
                    pendingNotifications.isEmpty ? 'معطل' : 'نشط',
                    style: const TextStyle(
                      color: Colors.white,
                      fontWeight: FontWeight.bold,
                    ),
                  ),
                ),
              ],
            ),
          ],
        ),
      ),
    );
  }

  Widget _buildNotificationsSection() {
    return Card(
      elevation: 4,
      shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(20)),
      child: Padding(
        padding: const EdgeInsets.all(20),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            Row(
              children: [
                Icon(
                  Icons.schedule_rounded,
                  color: Theme.of(context).primaryColor,
                  size: 28,
                ),
                const SizedBox(width: 12),
                const Text(
                  'الإشعارات المجدولة',
                  style: TextStyle(fontSize: 20, fontWeight: FontWeight.bold),
                ),
              ],
            ),
            const SizedBox(height: 16),
            if (pendingNotifications.isEmpty)
              _buildEmptyState()
            else
              ...pendingNotifications.map((notification) {
                return _buildNotificationCard(notification);
              }),
          ],
        ),
      ),
    );
  }

  Widget _buildEmptyState() {
    return Container(
      padding: const EdgeInsets.all(32),
      decoration: BoxDecoration(
        color: Colors.grey.shade50,
        borderRadius: BorderRadius.circular(15),
        border: Border.all(color: Colors.grey.shade200),
      ),
      child: Column(
        children: [
          Icon(
            Icons.notifications_off_outlined,
            size: 64,
            color: Colors.grey.shade400,
          ),
          const SizedBox(height: 16),
          Text(
            'لا توجد إشعارات مجدولة',
            style: TextStyle(
              fontSize: 18,
              fontWeight: FontWeight.bold,
              color: Colors.grey.shade600,
            ),
          ),
          const SizedBox(height: 8),
          Text(
            'قم بتفعيل الإشعارات من صفحة الأذكار',
            style: TextStyle(fontSize: 14, color: Colors.grey.shade500),
            textAlign: TextAlign.center,
          ),
        ],
      ),
    );
  }

  Widget _buildNotificationCard(PendingNotificationRequest notification) {
    final color = _getNotificationColor(notification.id);
    final icon = _getNotificationIcon(notification.id);
    final name = _getNotificationName(notification.id);
    final emoji = _getNotificationEmoji(notification.id);

    return Container(
      margin: const EdgeInsets.only(bottom: 12),
      decoration: BoxDecoration(
        color: color.withAlpha(13),
        borderRadius: BorderRadius.circular(15),
        border: Border.all(color: color.withAlpha(51), width: 1.5),
      ),
      child: Material(
        color: Colors.transparent,
        child: InkWell(
          borderRadius: BorderRadius.circular(15),
          onTap: () => _showNotificationDetails(notification),
          child: Padding(
            padding: const EdgeInsets.all(16),
            child: Row(
              children: [
                Container(
                  padding: const EdgeInsets.all(12),
                  decoration: BoxDecoration(
                    gradient: LinearGradient(
                      colors: [color, color.withAlpha(179)],
                    ),
                    borderRadius: BorderRadius.circular(12),
                    boxShadow: [
                      BoxShadow(
                        color: color.withAlpha(77),
                        blurRadius: 8,
                        offset: const Offset(0, 4),
                      ),
                    ],
                  ),
                  child: Icon(icon, color: Colors.white, size: 28),
                ),
                const SizedBox(width: 16),
                Expanded(
                  child: Column(
                    crossAxisAlignment: CrossAxisAlignment.start,
                    children: [
                      Row(
                        children: [
                          Text(
                            name,
                            style: TextStyle(
                              fontWeight: FontWeight.bold,
                              fontSize: 16,
                              color: color,
                            ),
                          ),
                          const SizedBox(width: 6),
                          Text(emoji, style: const TextStyle(fontSize: 16)),
                        ],
                      ),
                      const SizedBox(height: 6),
                      Text(
                        notification.body ?? '',
                        style: TextStyle(
                          fontSize: 13,
                          color: Colors.grey.shade700,
                        ),
                        maxLines: 2,
                        overflow: TextOverflow.ellipsis,
                      ),
                    ],
                  ),
                ),
                Column(
                  children: [
                    Container(
                      padding: const EdgeInsets.all(8),
                      decoration: BoxDecoration(
                        color: Colors.green.withAlpha(25),
                        borderRadius: BorderRadius.circular(10),
                      ),
                      child: const Icon(
                        Icons.check_circle,
                        color: Colors.green,
                        size: 20,
                      ),
                    ),
                    const SizedBox(height: 8),
                    IconButton(
                      icon: const Icon(Icons.delete_outline, color: Colors.red),
                      onPressed: () => _cancelNotification(notification.id),
                      tooltip: 'إلغاء',
                      padding: EdgeInsets.zero,
                      constraints: const BoxConstraints(),
                    ),
                  ],
                ),
              ],
            ),
          ),
        ),
      ),
    );
  }

  void _showNotificationDetails(PendingNotificationRequest notification) {
    final color = _getNotificationColor(notification.id);
    final icon = _getNotificationIcon(notification.id);
    final name = _getNotificationName(notification.id);

    showDialog(
      context: context,
      builder: (context) => AlertDialog(
        shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(20)),
        title: Row(
          children: [
            Container(
              padding: const EdgeInsets.all(8),
              decoration: BoxDecoration(
                color: color.withAlpha(25),
                borderRadius: BorderRadius.circular(10),
              ),
              child: Icon(icon, color: color, size: 24),
            ),
            const SizedBox(width: 12),
            Expanded(child: Text(name)),
          ],
        ),
        content: Column(
          mainAxisSize: MainAxisSize.min,
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            _buildDetailRow('العنوان', notification.title ?? 'غير محدد'),
            const Divider(),
            _buildDetailRow('الرسالة', notification.body ?? 'غير محددة'),
            const Divider(),
            _buildDetailRow('معرف الإشعار', notification.id.toString()),
          ],
        ),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context),
            child: const Text('إغلاق'),
          ),
          ElevatedButton.icon(
            onPressed: () {
              Navigator.pop(context);
              _cancelNotification(notification.id);
            },
            icon: const Icon(Icons.delete),
            label: const Text('إلغاء الإشعار'),
            style: ElevatedButton.styleFrom(
              backgroundColor: Colors.red,
              foregroundColor: Colors.white,
            ),
          ),
        ],
      ),
    );
  }

  Widget _buildDetailRow(String label, String value) {
    return Padding(
      padding: const EdgeInsets.symmetric(vertical: 8),
      child: Row(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          Text(
            '$label: ',
            style: const TextStyle(fontWeight: FontWeight.bold, fontSize: 14),
          ),
          Expanded(child: Text(value, style: const TextStyle(fontSize: 14))),
        ],
      ),
    );
  }

  Widget _buildQuickActions() {
    return Card(
      elevation: 4,
      color: Colors.red.shade50,
      shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(20)),
      child: Padding(
        padding: const EdgeInsets.all(20),
        child: Column(
          children: [
            Row(
              children: [
                Icon(
                  Icons.warning_amber_rounded,
                  color: Colors.red.shade700,
                  size: 28,
                ),
                const SizedBox(width: 12),
                const Expanded(
                  child: Text(
                    'إجراءات خطرة',
                    style: TextStyle(
                      fontSize: 20,
                      fontWeight: FontWeight.bold,
                      color: Colors.red,
                    ),
                  ),
                ),
              ],
            ),
            const SizedBox(height: 16),
            Container(
              padding: const EdgeInsets.all(12),
              decoration: BoxDecoration(
                color: Colors.red.shade100,
                borderRadius: BorderRadius.circular(10),
                border: Border.all(color: Colors.red.shade300),
              ),
              child: Row(
                children: [
                  Icon(Icons.info_outline, color: Colors.red.shade700),
                  const SizedBox(width: 8),
                  Expanded(
                    child: Text(
                      'سيتم إلغاء جميع الإشعارات المجدولة',
                      style: TextStyle(
                        color: Colors.red.shade700,
                        fontSize: 13,
                      ),
                    ),
                  ),
                ],
              ),
            ),
            const SizedBox(height: 16),
            SizedBox(
              width: double.infinity,
              child: ElevatedButton.icon(
                onPressed: _cancelAllNotifications,
                icon: const Icon(Icons.delete_forever),
                label: const Text(
                  'إلغاء جميع الإشعارات',
                  style: TextStyle(fontSize: 16, fontWeight: FontWeight.bold),
                ),
                style: ElevatedButton.styleFrom(
                  backgroundColor: Colors.red,
                  foregroundColor: Colors.white,
                  padding: const EdgeInsets.all(16),
                  shape: RoundedRectangleBorder(
                    borderRadius: BorderRadius.circular(15),
                  ),
                  elevation: 2,
                ),
              ),
            ),
          ],
        ),
      ),
    );
  }

  Widget _buildHelpSection() {
    return Card(
      elevation: 4,
      shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(20)),
      child: Padding(
        padding: const EdgeInsets.all(20),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            Row(
              children: [
                Icon(
                  Icons.help_outline_rounded,
                  color: Theme.of(context).primaryColor,
                  size: 28,
                ),
                const SizedBox(width: 12),
                const Text(
                  'معلومات مفيدة',
                  style: TextStyle(fontSize: 20, fontWeight: FontWeight.bold),
                ),
              ],
            ),
            const SizedBox(height: 16),
            _buildInfoItem(
              icon: Icons.check_circle_outline,
              text: 'تعمل الإشعارات حتى لو كان التطبيق مغلقاً',
              color: Colors.green,
            ),
            _buildInfoItem(
              icon: Icons.repeat,
              text: 'يتم تكرار الإشعارات يومياً في نفس الوقت',
              color: Colors.blue,
            ),
            _buildInfoItem(
              icon: Icons.edit,
              text: 'يمكنك تعديل أوقات الإشعارات من صفحة الأذكار',
              color: Colors.orange,
            ),
            _buildInfoItem(
              icon: Icons.battery_alert,
              text: 'تأكد من عدم تفعيل وضع توفير البطارية للتطبيق',
              color: Colors.red,
            ),
          ],
        ),
      ),
    );
  }

  Widget _buildInfoItem({
    required IconData icon,
    required String text,
    required Color color,
  }) {
    return Padding(
      padding: const EdgeInsets.only(bottom: 12),
      child: Row(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          Container(
            padding: const EdgeInsets.all(6),
            decoration: BoxDecoration(
              color: color.withAlpha(25),
              borderRadius: BorderRadius.circular(8),
            ),
            child: Icon(icon, size: 18, color: color),
          ),
          const SizedBox(width: 12),
          Expanded(
            child: Text(
              text,
              style: const TextStyle(height: 1.5, fontSize: 14),
            ),
          ),
        ],
      ),
    );
  }
}
import 'dart:typed_data';

import 'package:flutter/widgets.dart';
import 'package:flutter_local_notifications/flutter_local_notifications.dart';
import 'package:timezone/data/latest_all.dart' as tz;
import 'package:timezone/timezone.dart' as tz;

class NotificationService {
  static final FlutterLocalNotificationsPlugin _notifications =
      FlutterLocalNotificationsPlugin();

  static Future<void> initialize() async {
    // تهيئة المناطق الزمنية
    tz.initializeTimeZones();
    tz.setLocalLocation(tz.getLocation('Africa/Cairo'));

    // إعدادات Android مع تصميم احترافي
    const AndroidInitializationSettings androidSettings =
        AndroidInitializationSettings('@mipmap/ic_launcher');

    const DarwinInitializationSettings iosSettings =
        DarwinInitializationSettings(
          requestAlertPermission: true,
          requestBadgePermission: true,
          requestSoundPermission: true,
        );

    const InitializationSettings initSettings = InitializationSettings(
      android: androidSettings,
      iOS: iosSettings,
    );

    await _notifications.initialize(
      initSettings,
      onDidReceiveNotificationResponse: (NotificationResponse response) {
        debugPrint('تم الضغط على الإشعار: ${response.payload}');
      },
    );

    // إنشاء قنوات الإشعارات بأصوات مخصصة
    await _createNotificationChannels();

    // طلب الصلاحيات للأندرويد 13+
    final androidImplementation = _notifications
        .resolvePlatformSpecificImplementation<
          AndroidFlutterLocalNotificationsPlugin
        >();

    if (androidImplementation != null) {
      await androidImplementation.requestNotificationsPermission();
      await androidImplementation.requestExactAlarmsPermission();
    }
  }

  // إنشاء قنوات مخصصة لكل نوع من الأذكار
  static Future<void> _createNotificationChannels() async {
    final androidImplementation = _notifications
        .resolvePlatformSpecificImplementation<
          AndroidFlutterLocalNotificationsPlugin
        >();

    if (androidImplementation != null) {
      // قناة أذكار الصباح
      await androidImplementation.createNotificationChannel(
        AndroidNotificationChannel(
          'morning_azkar_channel',
          'أذكار الصباح',
          description: 'إشعارات أذكار الصباح',
          importance: Importance.max,
          playSound: true,
          enableVibration: true,
          enableLights: true,
          ledColor: Color(0xFFFFA726), // لون برتقالي
          vibrationPattern: Int64List.fromList([
            0,
            500,
            200,
            500,
          ]), // نمط اهتزاز مميز
          sound: RawResourceAndroidNotificationSound(
            'morning_sound',
          ), // صوت مخصص
        ),
      );

      // قناة أذكار المساء
      await androidImplementation.createNotificationChannel(
        AndroidNotificationChannel(
          'evening_azkar_channel',
          'أذكار المساء',
          description: 'إشعارات أذكار المساء',
          importance: Importance.max,
          playSound: true,
          enableVibration: true,
          enableLights: true,
          ledColor: Color(0xFF5C6BC0), // لون أزرق
          vibrationPattern: Int64List.fromList([0, 500, 200, 500]),
          sound: RawResourceAndroidNotificationSound('evening_sound'),
        ),
      );

      // قناة أذكار النوم
      await androidImplementation.createNotificationChannel(
        AndroidNotificationChannel(
          'sleep_azkar_channel',
          'أذكار النوم',
          description: 'إشعارات أذكار النوم',
          importance: Importance.max,
          playSound: true,
          enableVibration: true,
          enableLights: true,
          ledColor: Color(0xFF9C27B0), // لون بنفسجي
          vibrationPattern: Int64List.fromList([0, 500, 200, 500]),
          sound: RawResourceAndroidNotificationSound('sleep_sound'),
        ),
      );
    }

    debugPrint('✅ تم إنشاء قنوات الإشعارات بنجاح');
  }

  // إرسال إشعار فوري بتصميم احترافي
  static Future<void> showNotification({
    required int id,
    required String title,
    required String body,
    String? payload,
    String channelId = 'islamic_app_channel',
    Color? color,
  }) async {
    final AndroidNotificationDetails androidDetails =
        AndroidNotificationDetails(
          channelId,
          'الأذكار والصلاة',
          channelDescription: 'إشعارات الأذكار ومواقيت الصلاة',
          importance: Importance.max,
          priority: Priority.high,
          playSound: true,
          enableVibration: true,
          enableLights: true,
          color: color ?? const Color(0xFF1B5E20),
          icon: '@mipmap/ic_launcher',
          largeIcon: const DrawableResourceAndroidBitmap('@mipmap/ic_launcher'),
          ongoing: false,
          autoCancel: true,
          fullScreenIntent: true,
          // تصميم Big Text Style للنصوص الطويلة
          styleInformation: BigTextStyleInformation(
            body,
            htmlFormatBigText: true,
            contentTitle: title,
            htmlFormatContentTitle: true,
            summaryText: 'نَجَاتَك',
            htmlFormatSummaryText: true,
          ),
          // أزرار الإجراءات
          actions: <AndroidNotificationAction>[
            const AndroidNotificationAction(
              'open_app',
              'فتح التطبيق',
              icon: DrawableResourceAndroidBitmap('@mipmap/ic_launcher'),
              showsUserInterface: true,
            ),
            const AndroidNotificationAction(
              'dismiss',
              'تجاهل',
              cancelNotification: true,
            ),
          ],
        );

    const DarwinNotificationDetails iosDetails = DarwinNotificationDetails(
      presentAlert: true,
      presentBadge: true,
      presentSound: true,
    );

    final NotificationDetails notificationDetails = NotificationDetails(
      android: androidDetails,
      iOS: iosDetails,
    );

    await _notifications.show(
      id,
      title,
      body,
      notificationDetails,
      payload: payload,
    );

    debugPrint('تم إرسال إشعار فوري - ID: $id');
  }

  // جدولة إشعار يومي بتصميم احترافي
  static Future<void> scheduleDailyNotification({
    required int id,
    required String title,
    required String body,
    required int hour,
    required int minute,
    String? payload,
    required NotificationType type,
  }) async {
    try {
      await _notifications.cancel(id);

      // اختيار القناة والإعدادات حسب نوع الذكر
      String channelId;
      Color color;
      String emoji;

      switch (type) {
        case NotificationType.morning:
          channelId = 'morning_azkar_channel';
          color = const Color(0xFFFFA726);
          emoji = '🌅';
          break;
        case NotificationType.evening:
          channelId = 'evening_azkar_channel';
          color = const Color(0xFF5C6BC0);
          emoji = '🌙';
          break;
        case NotificationType.sleep:
          channelId = 'sleep_azkar_channel';
          color = const Color(0xFF9C27B0);
          emoji = '🌟';
          break;
      }

      final AndroidNotificationDetails androidDetails =
          AndroidNotificationDetails(
            channelId,
            _getChannelName(type),
            channelDescription: 'إشعارات ${_getChannelName(type)}',
            importance: Importance.max,
            priority: Priority.high,
            playSound: true,
            enableVibration: true,
            enableLights: true,
            color: color,
            icon: '@mipmap/ic_launcher',
            largeIcon: const DrawableResourceAndroidBitmap(
              '@mipmap/ic_launcher',
            ),
            ongoing: false,
            autoCancel: true,
            fullScreenIntent: true,
            channelShowBadge: true,
            showWhen: true,
            // تصميم Big Text مع الرموز التعبيرية
            styleInformation: BigTextStyleInformation(
              '$emoji $body',
              htmlFormatBigText: true,
              contentTitle: '$emoji $title',
              htmlFormatContentTitle: true,
              summaryText: 'نَجَاتَك - تطبيق الأذكار',
              htmlFormatSummaryText: true,
            ),
            // أزرار الإجراءات
            actions: <AndroidNotificationAction>[
              const AndroidNotificationAction(
                'open_azkar',
                'عرض الأذكار',
                icon: DrawableResourceAndroidBitmap('@mipmap/ic_launcher'),
                showsUserInterface: true,
              ),
              const AndroidNotificationAction(
                'dismiss',
                'حسناً',
                cancelNotification: true,
              ),
            ],
          );

      const DarwinNotificationDetails iosDetails = DarwinNotificationDetails(
        presentAlert: true,
        presentBadge: true,
        presentSound: true,
      );

      final NotificationDetails notificationDetails = NotificationDetails(
        android: androidDetails,
        iOS: iosDetails,
      );

      final scheduledDate = _nextInstanceOfTime(hour, minute);

      debugPrint('═══════════════════════════════════════');
      debugPrint('📅 جدولة إشعار جديد:');
      debugPrint('   النوع: ${_getChannelName(type)}');
      debugPrint('   ID: $id');
      debugPrint('   العنوان: $title');
      debugPrint('   الوقت: $hour:${minute.toString().padLeft(2, '0')}');
      debugPrint('═══════════════════════════════════════');

      await _notifications.zonedSchedule(
        id,
        '$emoji $title',
        '$emoji $body',
        scheduledDate,
        notificationDetails,
        androidScheduleMode: AndroidScheduleMode.exactAllowWhileIdle,
        matchDateTimeComponents: DateTimeComponents.time,
        payload: payload,
      );

      debugPrint('✅ تم جدولة الإشعار بنجاح!');
    } catch (e) {
      debugPrint('❌ خطأ في جدولة الإشعار: $e');
    }
  }

  static String _getChannelName(NotificationType type) {
    switch (type) {
      case NotificationType.morning:
        return 'أذكار الصباح';
      case NotificationType.evening:
        return 'أذكار المساء';
      case NotificationType.sleep:
        return 'أذكار النوم';
    }
  }

  static tz.TZDateTime _nextInstanceOfTime(int hour, int minute) {
    final tz.TZDateTime now = tz.TZDateTime.now(tz.local);
    tz.TZDateTime scheduledDate = tz.TZDateTime(
      tz.local,
      now.year,
      now.month,
      now.day,
      hour,
      minute,
      0,
    );

    if (scheduledDate.isBefore(now)) {
      scheduledDate = scheduledDate.add(const Duration(days: 1));
    }

    return scheduledDate;
  }

  static Future<void> cancelNotification(int id) async {
    await _notifications.cancel(id);
    debugPrint('🗑️ تم إلغاء الإشعار رقم: $id');
  }

  static Future<void> cancelAllNotifications() async {
    await _notifications.cancelAll();
    debugPrint('🗑️ تم إلغاء جميع الإشعارات');
  }

  static Future<List<PendingNotificationRequest>>
  getPendingNotifications() async {
    final pending = await _notifications.pendingNotificationRequests();
    debugPrint('📋 عدد الإشعارات المجدولة: ${pending.length}');
    return pending;
  }

  static Future<void> testNotification() async {
    await showNotification(
      id: 999,
      title: 'إشعار تجريبي',
      body: 'الإشعارات تعمل بشكل صحيح! ✓',
      color: const Color(0xFF1B5E20),
    );
  }

  static Future<void> testScheduledNotification() async {
    final now = tz.TZDateTime.now(tz.local);
    final scheduledTime = now.add(const Duration(minutes: 1));

    const AndroidNotificationDetails androidDetails =
        AndroidNotificationDetails(
          'morning_azkar_channel',
          'أذكار الصباح',
          importance: Importance.max,
          priority: Priority.high,
          playSound: true,
          enableVibration: true,
          color: Color(0xFFFFA726),
          icon: '@mipmap/ic_launcher',
          largeIcon: DrawableResourceAndroidBitmap('@mipmap/ic_launcher'),
          styleInformation: BigTextStyleInformation(
            '⏰ سيظهر هذا الإشعار بعد دقيقة واحدة',
            contentTitle: '🧪 اختبار إشعار مجدول',
            summaryText: 'نَجَاتَك',
          ),
        );

    const NotificationDetails notificationDetails = NotificationDetails(
      android: androidDetails,
    );

    await _notifications.zonedSchedule(
      998,
      '🧪 اختبار إشعار مجدول',
      '⏰ سيظهر هذا الإشعار بعد دقيقة واحدة',
      scheduledTime,
      notificationDetails,
      androidScheduleMode: AndroidScheduleMode.exactAllowWhileIdle,
    );

    debugPrint('✅ تم جدولة إشعار تجريبي بعد دقيقة واحدة');
  }
}

// نوع الإشعار (Enum)
enum NotificationType { morning, evening, sleep }
import 'package:flutter/material.dart';

import '../../models/azkar_model.dart';
import 'azkar_item_widget.dart'; // استيراد ويدجت العنصر

typedef AzkarItemTapCallback =
    void Function(Azkar azkar, Color color, Gradient gradient);

class AzkarCategoryWidget extends StatelessWidget {
  final String title;
  final String subtitle;
  final IconData icon;
  final Color color;
  final Gradient gradient;
  final List<Azkar> azkarList;
  final bool? notificationEnabled;
  final Function(bool)? onNotificationToggle;
  final TimeOfDay? currentTime;
  final VoidCallback? onChangeTime;
  final AzkarItemTapCallback onAzkarItemTap; // دالة تمرير لفتح تفاصيل الذكر

  const AzkarCategoryWidget({
    super.key,
    required this.title,
    required this.subtitle,
    required this.icon,
    required this.color,
    required this.gradient,
    required this.azkarList,
    this.notificationEnabled,
    this.onNotificationToggle,
    this.currentTime,
    this.onChangeTime,
    required this.onAzkarItemTap,
  });

  @override
  Widget build(BuildContext context) {
    return Hero(
      tag: title,
      child: Card(
        elevation: 8,
        shadowColor: color.withAlpha(77),
        shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(20)),
        child: Container(
          decoration: BoxDecoration(
            borderRadius: BorderRadius.circular(20),
            gradient: LinearGradient(
              begin: Alignment.topRight,
              end: Alignment.bottomLeft,
              colors: [Colors.white, color.withAlpha(13)],
            ),
          ),
          child: Theme(
            data: Theme.of(context).copyWith(dividerColor: Colors.transparent),
            child: ExpansionTile(
              tilePadding: const EdgeInsets.symmetric(
                horizontal: 20,
                vertical: 8,
              ),
              childrenPadding: const EdgeInsets.only(bottom: 16),
              leading: Container(
                padding: const EdgeInsets.all(12),
                decoration: BoxDecoration(
                  gradient: gradient,
                  borderRadius: BorderRadius.circular(15),
                  boxShadow: [
                    BoxShadow(
                      color: color.withAlpha(77),
                      blurRadius: 8,
                      offset: const Offset(0, 4),
                    ),
                  ],
                ),
                child: Icon(icon, color: Colors.white, size: 28),
              ),
              title: Text(
                title,
                style: TextStyle(
                  fontSize: 20,
                  fontWeight: FontWeight.bold,
                  color: color,
                ),
              ),
              subtitle: Padding(
                padding: const EdgeInsets.only(top: 4),
                child: Text(
                  subtitle,
                  style: TextStyle(fontSize: 13, color: Colors.black),
                ),
              ),
              trailing: onNotificationToggle != null
                  ? Container(
                      padding: const EdgeInsets.all(8),
                      decoration: BoxDecoration(
                        color: notificationEnabled!
                            ? Colors.green.withAlpha(25)
                            : Colors.grey.withAlpha(25),
                        borderRadius: BorderRadius.circular(12),
                      ),
                      child: Row(
                        mainAxisSize: MainAxisSize.min,
                        children: [
                          Icon(
                            notificationEnabled!
                                ? Icons.notifications_active
                                : Icons.notifications_off,
                            color: notificationEnabled!
                                ? Colors.green
                                : Colors.grey,
                            size: 20,
                          ),
                          const SizedBox(width: 8),
                          const Icon(Icons.expand_more, size: 20),
                        ],
                      ),
                    )
                  : null,
              children: [
                if (onNotificationToggle != null)
                  _buildNotificationSettings(context),

                const SizedBox(height: 8),

                Container(
                  margin: const EdgeInsets.symmetric(horizontal: 16),
                  child: Row(
                    children: [
                      Container(
                        padding: const EdgeInsets.symmetric(
                          horizontal: 12,
                          vertical: 6,
                        ),
                        decoration: BoxDecoration(
                          color: color.withAlpha(25),
                          borderRadius: BorderRadius.circular(20),
                        ),
                        child: Row(
                          children: [
                            Icon(
                              Icons.format_list_numbered,
                              color: color,
                              size: 16,
                            ),
                            const SizedBox(width: 4),
                            Text(
                              '${azkarList.length} ذكر',
                              style: TextStyle(
                                color: color,
                                fontWeight: FontWeight.bold,
                                fontSize: 12,
                              ),
                            ),
                          ],
                        ),
                      ),
                    ],
                  ),
                ),
                const SizedBox(height: 12),
                ...azkarList.asMap().entries.map((entry) {
                  final index = entry.key;
                  final azkar = entry.value;
                  return AzkarItemWidget(
                    azkar: azkar,
                    color: color,
                    gradient: gradient,
                    index: index,
                    onTap: () => onAzkarItemTap(azkar, color, gradient),
                  );
                }),
              ],
            ),
          ),
        ),
      ),
    );
  }

  Widget _buildNotificationSettings(BuildContext context) {
    return Container(
      margin: const EdgeInsets.symmetric(horizontal: 16, vertical: 8),
      decoration: BoxDecoration(
        color: color.withAlpha(13),
        borderRadius: BorderRadius.circular(15),
        border: Border.all(color: color.withAlpha(51)),
      ),
      child: Column(
        children: [
          SwitchListTile(
            title: Text(
              'تفعيل التنبيه اليومي',
              style: TextStyle(fontWeight: FontWeight.bold, color: color),
            ),
            subtitle: Text(
              notificationEnabled!
                  ? 'سيصلك التنبيه يومياً الساعة ${currentTime!.format(context)}'
                  : 'قم بتفعيل التنبيه لاختيار الوقت',
              style: TextStyle(fontSize: 12, color: Colors.grey[600]),
            ),
            value: notificationEnabled!,
            onChanged: onNotificationToggle,
            activeThumbColor: color,
            shape: RoundedRectangleBorder(
              borderRadius: BorderRadius.circular(15),
            ),
          ),
          if (notificationEnabled! && onChangeTime != null)
            InkWell(
              onTap: onChangeTime,
              borderRadius: BorderRadius.circular(15),
              child: Container(
                padding: const EdgeInsets.all(16),
                child: Row(
                  children: [
                    Container(
                      padding: const EdgeInsets.all(8),
                      decoration: BoxDecoration(
                        color: color.withAlpha(25),
                        borderRadius: BorderRadius.circular(10),
                      ),
                      child: Icon(Icons.access_time, color: color, size: 20),
                    ),
                    const SizedBox(width: 12),
                    Expanded(
                      child: Column(
                        crossAxisAlignment: CrossAxisAlignment.start,
                        children: [
                          Text(
                            'تغيير وقت التنبيه',
                            style: TextStyle(
                              fontWeight: FontWeight.bold,
                              color: color,
                            ),
                          ),
                          Text(
                            'الوقت الحالي: ${currentTime!.format(context)}',
                            style: TextStyle(
                              fontSize: 12,
                              color: Colors.grey[600],
                            ),
                          ),
                        ],
                      ),
                    ),
                    Icon(Icons.edit, color: color, size: 20),
                  ],
                ),
              ),
            ),
        ],
      ),
    );
  }
}
import 'package:flutter/material.dart';
import 'package:najatak/widgets/azkar_handle_widget.dart';
import 'package:najatak/widgets/azkar_tap_button.dart';

import '../models/azkar_model.dart';

class AzkarDetailsSheet extends StatefulWidget {
  final Azkar azkar;
  final Color color;
  final Gradient gradient;

  const AzkarDetailsSheet({
    super.key,
    required this.azkar,
    required this.color,
    required this.gradient,
  });

  @override
  State<AzkarDetailsSheet> createState() => _AzkarDetailsSheetState();
}

class _AzkarDetailsSheetState extends State<AzkarDetailsSheet>
    with SingleTickerProviderStateMixin {
  int currentCount = 0;
  late AnimationController _controller;
  late Animation<double> _scaleAnimation;

  @override
  void initState() {
    super.initState();
    _controller = AnimationController(
      duration: const Duration(milliseconds: 200),
      vsync: this,
    );
    _scaleAnimation = Tween<double>(
      begin: 1.0,
      end: 0.95,
    ).animate(CurvedAnimation(parent: _controller, curve: Curves.easeInOut));
  }

  @override
  void dispose() {
    _controller.dispose();
    super.dispose();
  }

  void _incrementCount() {
    if (currentCount < widget.azkar.countInt) {
      _controller.forward().then((_) => _controller.reverse());
      setState(() {
        currentCount++;
      });

      if (currentCount == widget.azkar.countInt) {
        Future.delayed(const Duration(milliseconds: 300), () {
          if (mounted) {
            _showCompletionDialog();
          }
        });
      }
    }
  }

  void _showCompletionDialog() {
    showDialog(
      context: context,
      builder: (context) => Dialog(
        shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(20)),
        child: Container(
          padding: const EdgeInsets.all(24),
          decoration: BoxDecoration(
            borderRadius: BorderRadius.circular(20),
            gradient: widget.gradient,
          ),
          child: Column(
            mainAxisSize: MainAxisSize.min,
            children: [
              Container(
                padding: const EdgeInsets.all(16),
                decoration: BoxDecoration(
                  color: Colors.white.withAlpha(77),
                  shape: BoxShape.circle,
                ),
                child: const Icon(
                  Icons.check_circle,
                  color: Colors.white,
                  size: 60,
                ),
              ),
              const SizedBox(height: 20),
              const Text(
                'بارك الله فيك!',
                style: TextStyle(
                  fontSize: 24,
                  fontWeight: FontWeight.bold,
                  color: Colors.white,
                ),
              ),
              const SizedBox(height: 8),
              const Text(
                'أكملت الذكر بنجاح ✨',
                style: TextStyle(fontSize: 16, color: Colors.white),
                textAlign: TextAlign.center,
              ),
              const SizedBox(height: 24),
              ElevatedButton(
                onPressed: () {
                  Navigator.pop(context);
                  setState(() {
                    currentCount = 0;
                  });
                },
                style: ElevatedButton.styleFrom(
                  backgroundColor: Colors.white,
                  foregroundColor: widget.color,
                  padding: const EdgeInsets.symmetric(
                    horizontal: 32,
                    vertical: 12,
                  ),
                  shape: RoundedRectangleBorder(
                    borderRadius: BorderRadius.circular(25),
                  ),
                ),
                child: const Text(
                  'إعادة',
                  style: TextStyle(fontWeight: FontWeight.bold),
                ),
              ),
            ],
          ),
        ),
      ),
    );
  }

  // ------------------------------------------------------------
  // بناء الويدجت الداخلية (تم دمج بعضها نظراً لصغرها)
  // ------------------------------------------------------------

  Widget _buildHeader(BuildContext context) {
    return Padding(
      padding: const EdgeInsets.symmetric(horizontal: 20, vertical: 8),
      child: Row(
        mainAxisAlignment: MainAxisAlignment.spaceBetween,
        children: [
          Text(
            'تفاصيل الذكر',
            style: TextStyle(
              fontSize: 24,
              fontWeight: FontWeight.bold,
              color: widget.color,
            ),
          ),
          IconButton(
            icon: const Icon(Icons.close, size: 28),
            color: widget.color,
            onPressed: () => Navigator.pop(context),
          ),
        ],
      ),
    );
  }

  Widget _buildAzkarText() {
    return Text(
      widget.azkar.zekr,
      textAlign: TextAlign.center,
      style: const TextStyle(
        fontSize: 24,
        fontWeight: FontWeight.bold,
        color: Color(0xFF303030),
      ),
    );
  }

  Widget _buildReferenceContainer() {
    if (widget.azkar.reference == null && widget.azkar.description == null) {
      return const SizedBox.shrink();
    }

    return Container(
      padding: const EdgeInsets.all(16),
      decoration: BoxDecoration(
        color: widget.color.withAlpha(13),
        borderRadius: BorderRadius.circular(15),
        border: Border.all(color: widget.color.withAlpha(25)),
      ),
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.stretch,
        children: [
          if (widget.azkar.reference != null)
            Text(
              'المصدر: ${widget.azkar.reference!}',
              textAlign: TextAlign.right,
              style: TextStyle(
                color: widget.color,
                fontWeight: FontWeight.bold,
                fontSize: 14,
              ),
            ),
          if (widget.azkar.reference != null &&
              widget.azkar.description != null)
            const Divider(height: 16, color: Colors.grey, thickness: 0.5),
          if (widget.azkar.description != null)
            Text(
              widget.azkar.description!,
              textAlign: TextAlign.right,
              style: TextStyle(color: Colors.black, fontSize: 14),
            ),
        ],
      ),
    );
  }

  Widget _buildProgressIndicator() {
    if (widget.azkar.countInt <= 1) return const SizedBox.shrink();

    final progress = currentCount / widget.azkar.countInt;

    return Padding(
      padding: const EdgeInsets.symmetric(horizontal: 20, vertical: 10),
      child: ClipRRect(
        borderRadius: BorderRadius.circular(10),
        child: LinearProgressIndicator(
          value: progress,
          minHeight: 10,
          backgroundColor: widget.color.withAlpha(25),
          valueColor: AlwaysStoppedAnimation<Color>(widget.color),
        ),
      ),
    );
  }

  // دالة Build الرئيسية (استدعاء الدوال المنقحة)
  @override
  Widget build(BuildContext context) {
    return Container(
      height: MediaQuery.of(context).size.height * 0.88,
      decoration: const BoxDecoration(
        color: Colors.white,
        borderRadius: BorderRadius.vertical(top: Radius.circular(30)),
      ),
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          const AzkarHandleWidget(),
          _buildHeader(context),
          Spacer(),
          Padding(
            padding: const EdgeInsets.symmetric(horizontal: 20),
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.stretch,
              children: [
                _buildAzkarText(),
                const SizedBox(height: 24),
                _buildReferenceContainer(),
                const SizedBox(height: 12),
              ],
            ),
          ),

          _buildProgressIndicator(),
          AzkarTapButton(
            currentCount: currentCount,
            totalCount: widget.azkar.countInt,
            color: widget.color,
            gradient: widget.gradient,
            scaleAnimation: _scaleAnimation,
            onTap: _incrementCount,
            onCompleted: _showCompletionDialog,
          ),
          Spacer(),
        ],
      ),
    );
  }
}
import 'package:flutter/material.dart';

class AzkarHandleWidget extends StatelessWidget {
  const AzkarHandleWidget({super.key});

  @override
  Widget build(BuildContext context) {
    return Container(
      margin: const EdgeInsets.symmetric(vertical: 12),
      width: 50,
      height: 5,
      decoration: BoxDecoration(
        color: Colors.grey[300],
        borderRadius: BorderRadius.circular(2.5),
      ),
    );
  }
}
import 'package:flutter/material.dart';

import '../../models/azkar_model.dart';

class AzkarItemWidget extends StatelessWidget {
  final Azkar azkar;
  final Color color;
  final Gradient gradient;
  final int index;
  final VoidCallback onTap;

  const AzkarItemWidget({
    super.key,
    required this.azkar,
    required this.color,
    required this.gradient,
    required this.index,
    required this.onTap,
  });

  @override
  Widget build(BuildContext context) {
    return Container(
      margin: const EdgeInsets.symmetric(horizontal: 16, vertical: 6),
      decoration: BoxDecoration(
        color: Colors.white,
        borderRadius: BorderRadius.circular(15),
        border: Border.all(color: color.withAlpha(51)),
        boxShadow: [
          BoxShadow(
            color: color.withAlpha(25),
            blurRadius: 4,
            offset: const Offset(0, 2),
          ),
        ],
      ),
      child: InkWell(
        onTap: onTap,
        borderRadius: BorderRadius.circular(15),
        child: Padding(
          padding: const EdgeInsets.all(16),
          child: Row(
            children: [
              Container(
                width: 36,
                height: 36,
                decoration: BoxDecoration(
                  gradient: gradient,
                  borderRadius: BorderRadius.circular(10),
                ),
                child: Center(
                  child: Text(
                    '${index + 1}',
                    style: const TextStyle(
                      color: Colors.white,
                      fontWeight: FontWeight.bold,
                      fontSize: 16,
                    ),
                  ),
                ),
              ),
              const SizedBox(width: 12),
              Expanded(
                child: Column(
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    Text(
                      azkar.zekr,
                      style: const TextStyle(
                        fontSize: 14,
                        height: 1.8,
                        fontWeight: FontWeight.w600,
                      ),
                      maxLines: 2,
                      overflow: TextOverflow.ellipsis,
                    ),
                    if (azkar.reference != null) ...[
                      const SizedBox(height: 4),
                      Text(
                        azkar.reference!,
                        style: TextStyle(fontSize: 11, color: Colors.grey[600]),
                      ),
                    ],
                  ],
                ),
              ),
              const SizedBox(width: 8),
              Column(
                children: [
                  if (azkar.countInt > 1)
                    Container(
                      padding: const EdgeInsets.symmetric(
                        horizontal: 8,
                        vertical: 6,
                      ),
                      decoration: BoxDecoration(
                        gradient: gradient,
                        borderRadius: BorderRadius.circular(20),
                        boxShadow: [
                          BoxShadow(
                            color: color.withAlpha(77),
                            blurRadius: 4,
                            offset: const Offset(0, 2),
                          ),
                        ],
                      ),
                      child: Text(
                        '${azkar.countInt}×',
                        style: const TextStyle(
                          color: Colors.white,
                          fontWeight: FontWeight.bold,
                          fontSize: 12,
                        ),
                      ),
                    ),
                  const SizedBox(height: 4),
                  Icon(Icons.arrow_forward_ios, color: color, size: 16),
                ],
              ),
            ],
          ),
        ),
      ),
    );
  }
}
import 'package:flutter/material.dart';

class AzkarTapButton extends StatelessWidget {
  final int currentCount;
  final int totalCount;
  final Color color;
  final Gradient gradient;
  final Animation<double> scaleAnimation;
  final VoidCallback onTap;
  final VoidCallback onCompleted;

  const AzkarTapButton({
    super.key,
    required this.currentCount,
    required this.totalCount,
    required this.color,
    required this.gradient,
    required this.scaleAnimation,
    required this.onTap,
    required this.onCompleted,
  });

  @override
  Widget build(BuildContext context) {
    final bool isCompleted = currentCount >= totalCount;
    final Color buttonColor = isCompleted ? Colors.green : color;

    return GestureDetector(
      onTap: isCompleted
          ? () {
              Navigator.pop(context); // إغلاق الـ Bottom Sheet
              onCompleted(); // استدعاء دالة عرض نافذة الإكمال
            }
          : onTap,
      child: ScaleTransition(
        scale: scaleAnimation,
        child: Container(
          margin: const EdgeInsets.all(12),
          padding: const EdgeInsets.all(18),
          decoration: BoxDecoration(
            gradient: isCompleted
                ? const LinearGradient(
                    colors: [Colors.green, Color(0xFF1B5E20)],
                  )
                : gradient,
            borderRadius: BorderRadius.circular(25),
            boxShadow: [
              BoxShadow(
                color: buttonColor.withAlpha(102),
                blurRadius: 10,
                offset: const Offset(0, 5),
              ),
            ],
          ),
          child: Column(
            mainAxisAlignment: MainAxisAlignment.center,
            children: [
              Text(
                isCompleted ? 'تم الإكمال! انقر للإنهاء' : 'انقر للتسبيح',
                style: const TextStyle(
                  color: Colors.white,
                  fontSize: 18,
                  fontWeight: FontWeight.bold,
                ),
              ),
              const SizedBox(height: 4),
              Text(
                '$currentCount / $totalCount',
                style: const TextStyle(color: Colors.white70, fontSize: 14),
              ),
            ],
          ),
        ),
      ),
    );
  }
}
